<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <title>PaintWorkz Pro 4.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --gold: linear-gradient(145deg, #d4af37, #f9f1b0, #aa841e);
            --panel-clr: #34c759;
            --door-clr: #ff9500;
            --drawer-clr: #2196f3;
            --custom-clr: #af52de;
            --moulded-clr: #d4af37;
        }

        /* Adjusted Part Label Styles */
        .part-card-header { font-size: 10px; font-weight: 900; text-align: center; text-transform: uppercase; margin-bottom: 2px; }
        .sqm-display-row { font-size: 14px; font-weight: 900; color: #444; margin-top: 5px; border-top: 1px solid #eee; padding-top: 2px; }
        
        /* Color variants for labels */
        .type-panel { color: var(--panel-clr); }
        .type-door { color: var(--door-clr); }
        .type-drawer { color: var(--drawer-clr); }
        .type-custom { color: var(--custom-clr); }

        /* Notification Toast */
        #toast { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
            background: #333; color: #fff; padding: 12px 24px; border-radius: 50px; 
            font-weight: 900; z-index: 10000; display: none; border: 2px solid var(--gs);
        }

        /* Rest of the previous CSS remains... (truncated for brevity) */
    </style>
</head>
<body>

<div id="toast">Part Added</div>

<header>
    <div style="font-size:32px" onclick="tab('history')">üîç</div>
    <div class="logo-box"><span class="logo-text">PaintWorkz</span></div>
    <div style="font-size:32px" onclick="saveJob()">üíæ</div>
</header>

<div class="nav-tabs">
    <div class="nav-btn active" id="btn-measure" onclick="tab('measure')">Measure</div>
    <div class="nav-btn" id="btn-db" onclick="tab('db')">Database</div>
    <div class="nav-btn" id="btn-history" onclick="tab('history')">History</div>
    <div class="nav-btn" id="btn-forms" onclick="tab('forms')">Forms</div>
    <div class="nav-btn" id="btn-schedule" onclick="tab('schedule')">Schedule</div>
    <div class="nav-btn" id="btn-settings" onclick="tab('settings')">Settings</div>
</div>

<div id="sub-nav-bar" class="sub-nav" style="display:none;"></div>

<div class="container">
    <div id="measure" class="view-section active">
        <div style="display:flex;gap:8px;margin:15px 0;">
            <div id="pP" class="p-card active" onclick="setP('Panel')"><svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="1"></rect></svg>PANEL</div>
            <div id="pD" class="p-card" onclick="setP('Door')"><svg viewBox="0 0 24 24"><path d="M5 3h14v18H5V3zm10 9v1"></path></svg>DOOR</div>
            <div id="pDr" class="p-card" onclick="setP('Drawer')"><svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="6" rx="1"></rect><rect x="3" y="13" width="18" height="6" rx="1"></rect></svg>DRAWER</div>
            <div id="pC" class="p-card" onclick="setP('Custom')"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>CUSTOM</div>
        </div>
        <div id="list"></div>
    </div>

    <div id="forms" class="view-section">
        <div class="card">
            <h3>Documents & Reports</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="t-btn" onclick="genForm('Estimate')">Estimate</button>
                <button class="t-btn" onclick="genForm('Quote')">Quote</button>
                <button class="t-btn" onclick="genForm('Invoice')">Invoice</button>
                <button class="t-btn" onclick="genForm('PriceList')">Price List</button>
                <button class="t-btn" onclick="genForm('SupplyDocket')">Supply Docket</button>
                <button class="t-btn" onclick="genForm('OrderForm')">Order Form</button>
                <button class="t-btn" onclick="genForm('MixingCard')">Mixing Card</button>
                <button class="t-btn" onclick="genForm('Schedule')">Schedule</button>
            </div>
        </div>
    </div>
</div>

<script>
// --- EXTENDED LOGIC ---
let jobHistory = JSON.parse(localStorage.getItem('pw_history')) || [];

function notify(msg) {
    const t = document.getElementById('toast');
    t.innerText = msg;
    t.style.display = 'block';
    setTimeout(() => { t.style.display = 'none'; }, 2000);
}

// Fixed Recall Job Function
function recallJob(jobId) {
    const job = jobHistory.find(j => j.id === jobId);
    if(job) {
        items = [...job.items];
        document.getElementById('cli').value = job.client;
        document.getElementById('jN').value = job.jobNo;
        document.getElementById('jNm').value = job.jobName;
        render();
        tab('measure');
        notify("Job Reloaded");
    }
}

// Adjusted Render for the specific Label requested
function render() {
    const l = document.getElementById('list');
    l.innerHTML = '';
    items.forEach((it, i) => {
        const typeClass = `type-${it.pType.toLowerCase()}`;
        const rowTotalSqm = parseFloat(it.sqm) * it.qty;

        l.innerHTML += `
        <div class="card" style="display:flex;align-items:center;gap:10px;padding:8px;">
            <div class="qty-bubble">${it.qty}</div>
            
            <div style="flex:1">
                <div class="part-card-header ${typeClass}">${it.pType}</div>
                <div style="font-weight:900;font-size:18px;">${it.h} x ${it.w}</div>
                <div style="font-size:11px;color:#666;">
                    ${it.color} | <span class="mld-bubble">${it.style}</span>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; align-items:center;">
                <div class="mode-box mode-${it.mode}">${it.mode}</div>
                <div class="sqm-display-row">${rowTotalSqm.toFixed(3)} m¬≤</div>
            </div>
            
            <button onclick="items.splice(${i},1);render()" style="color:red;border:0;background:0;font-size:26px;">√ó</button>
        </div>`;
    });
    // Update footer totals...
}

// (Database and Schedule Logic will follow in the next block)
</script>
</body>
</html>
