<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <title>PaintWorkz Pro 5.0 - Ultimate Save Point</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --gold: linear-gradient(145deg, #d4af37, #f9f1b0, #aa841e);
            --rainbow: linear-gradient(90deg, #ff3b30, #ff9500, #ffcc00, #4cd964, #5ac8fa, #007aff, #5856d6);
            --gs: #d4af37; --panel-clr: #34c759; --door-clr: #ff9500; --drawer-clr: #2196f3; --custom-clr: #af52de; --bg: #f2f2f7;
        }
        body { margin:0; font-family:-apple-system, system-ui, sans-serif; background:var(--bg); padding-bottom:140px; -webkit-tap-highlight-color:transparent; }
        
        /* HEADER & NOTIFS */
        header { background:var(--rainbow); padding:env(safe-area-inset-top) 15px 5px; display:flex; align-items:center; justify-content:space-between; border-bottom:4px solid #aa841e; position:sticky; top:0; z-index:1000; height:80px; box-sizing: border-box; }
        .logo-box { background:#000; padding:6px 18px; border-radius:50px; border:2px solid var(--gs); }
        .logo-text { font-weight:900; font-size:20px; background:var(--gold); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .notif-banner { background: #000; color: var(--gs); padding: 10px; font-size: 11px; font-weight: 900; border-bottom: 2px solid var(--gs); display: none; text-align: center; }

        /* TABS */
        .nav-tabs { display: flex; background: #000; position: sticky; top: 80px; z-index: 999; overflow-x: auto; }
        .nav-btn { flex:1; min-width:75px; padding:12px 0; color:#888; text-align:center; font-weight:900; font-size:9px; text-transform:uppercase; border:none; background:0 0; }
        .nav-btn.active { color:#fff; border-bottom:4px solid var(--gs); background:#111; }

        .container { padding: 15px; max-width: 600px; margin: auto; }
        .view-section { display:none; } .view-section.active { display:block; }
        .card { background:#fff; border-radius:12px; padding:15px; margin-bottom:12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }

        /* INPUTS */
        label { font-size: 9px; font-weight: 900; color: #666; text-transform: uppercase; margin-bottom: 2px; display: block; }
        input, select { width:100%; height:45px; border-radius:8px; border:1px solid #ccc; padding:0 10px; font-size:16px; box-sizing:border-box; background:#fff; margin-bottom: 8px; font-weight: 600; }
        
        /* SCHEDULE & FORMS */
        .sch-card { border-left: 6px solid #ccc; }
        .sch-card.urgent { border-left-color: #ff3b30; background: #fff5f5; }
        .sch-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .sch-item { background: #f2f2f7; padding: 8px; border-radius: 6px; border: 1px solid #ddd; }
        .sch-date { font-weight: 900; font-size: 12px; color: #000; border:none; background:transparent; width:100%; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .form-card { background: #000; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid var(--gs); cursor: pointer; color: var(--gs); }

        /* DATABASE TABS */
        .sub-nav { display: flex; gap: 5px; margin-bottom: 15px; background: #e5e5ea; padding: 4px; border-radius: 10px; }
        .sub-btn { flex: 1; padding: 8px; border: none; border-radius: 7px; font-weight: 800; font-size: 11px; color: #666; background: transparent; }
        .sub-btn.active { background: #fff; color: #000; }
        .db-list { max-height: 400px; overflow-y: auto; }
        .db-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; font-weight: 600; font-size: 14px; }

        .sticky-footer { background: #000; position: fixed; bottom: 0; left: 0; right: 0; height: 80px; border-top: 3px solid var(--gs); color: #fff; display: flex; justify-content: space-around; align-items: center; z-index: 2000; }
        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 12px 25px; border-radius: 30px; font-weight: 900; z-index: 3000; display: none; border: 1px solid var(--gs); }
        
        /* MEASURE TOOLS */
        .bubble-row { display: flex; gap: 6px; margin: 8px 0; }
        .bubble-unit { flex: 1; background: #fff; border: 1px solid #ccc; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 50px; }
        .bubble-unit input { border: none; text-align: center; font-size: 18px; font-weight: 900; height: 25px; margin:0; }
        .edge-row { display:flex; justify-content:space-between; align-items:center; margin:10px 0; gap:6px; }
        .edge-box { flex:1; height:40px; border-radius:8px; border:2px solid #ddd; background:#fff; display:flex; align-items:center; justify-content:center; font-weight:900; color:#ccc; }
        .edge-box.active { background:#34c759; border-color:#28a745; color:#fff; }
        .p-card { flex:1; background:#fff; border:2px solid #ddd; border-radius:8px; padding:8px 0; text-align:center; font-weight:900; font-size:9px; color:#444; cursor:pointer; }
        .p-card.active { border-color:var(--gs); background:#fff9e6; color:#000; }
    </style>
</head>
<body>

<div id="notif-bar" class="notif-banner"></div>
<div id="toast">Saved</div>

<header>
    <div class="logo-box"><span class="logo-text">PaintWorkz</span></div>
    <div style="color:var(--gs); font-weight:900; font-size:10px;">PRO 5.0</div>
</header>

<div class="nav-tabs">
    <div class="nav-btn active" id="btn-measure" onclick="tab('measure')">Measure</div>
    <div class="nav-btn" id="btn-schedule" onclick="tab('schedule')">Schedule</div>
    <div class="nav-btn" id="btn-db" onclick="tab('db')">Database</div>
    <div class="nav-btn" id="btn-forms" onclick="tab('forms')">Forms</div>
    <div class="nav-btn" id="btn-history" onclick="tab('history')">History</div>
    <div class="nav-btn" id="btn-admin" onclick="tab('admin')">Admin</div>
</div>

<div class="container">
    
    <div id="measure" class="view-section active">
        <div class="card">
            <div style="display:flex; gap:8px;">
                <div style="flex:2"><label>Client</label><select id="cli"></select></div>
                <div style="flex:1"><label>Date Received</label><input type="date" id="dRec" onchange="checkAutoSch()"></div>
            </div>
            <div style="display:flex; gap:8px;">
                <div style="flex:2"><label>Job Name</label><input type="text" id="jNm" placeholder="Job Reference"></div>
                <div style="flex:1"><label>Job #</label><input type="text" id="jN" placeholder="####"></div>
            </div>
            
            <label>Part Type</label>
            <div class="bubble-row">
                <div id="pP" class="p-card active" onclick="setP('Panel')">PANEL</div>
                <div id="pD" class="p-card" onclick="setP('Door')">DOOR</div>
                <div id="pDr" class="p-card" onclick="setP('Drawer')">DRAWER</div>
                <div id="pC" class="p-card" onclick="setP('Custom')">CUSTOM</div>
            </div>

            <div class="bubble-row">
                <div class="bubble-unit"><input type="number" id="h" placeholder="H" inputmode="decimal" oninput="up()"></div>
                <div class="bubble-unit"><input type="number" id="w" placeholder="W" inputmode="decimal" oninput="up()"></div>
                <div class="bubble-unit"><input type="number" id="qty" value="1" inputmode="numeric"></div>
            </div>

            <label>Edge Treatment</label>
            <div class="edge-row">
                <div class="edge-box" id="E1" onclick="tE(this)">L</div>
                <div class="edge-box" id="E2" onclick="tE(this)">L</div>
                <div class="edge-box" id="E3" onclick="tE(this)">S</div>
                <div class="edge-box" id="E4" onclick="tE(this)">S</div>
            </div>

            <div id="liveSq" style="font-size: 40px; font-weight: 900; color: var(--gs); text-align: center;">0.000</div>
            <button onclick="addPart()" style="width:100%; background:var(--gold); padding:15px; border-radius:30px; border:none; font-weight:900; margin-top:10px;">ADD PART +</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="schedule" class="view-section">
        <div id="schedule-list"></div>
    </div>

    <div id="db" class="view-section">
        <div class="sub-nav">
            <button class="sub-btn active" id="sub-btn-clients" onclick="subTab('clients')">CLIENTS</button>
            <button class="sub-btn" id="sub-btn-profiles" onclick="subTab('profiles')">DOOR PROFILES</button>
        </div>
        <div id="sub-clients" class="sub-section active">
            <div class="card"><div class="db-list" id="list-clients"></div></div>
        </div>
        <div id="sub-profiles" class="sub-section" style="display:none;">
            <div class="card"><div class="db-list" id="list-profiles"></div></div>
        </div>
    </div>

    <div id="forms" class="view-section">
        <div class="card">
            <h3 style="margin-top:0">Templates</h3>
            <div class="form-grid">
                <div class="form-card" onclick="genForm('Estimate')">ESTIMATE</div>
                <div class="form-card" onclick="genForm('Supply Docket')">SUPPLY DOCKET</div>
                <div class="form-card" onclick="genForm('Mixing Card')">MIXING CARD</div>
                <div class="form-card" onclick="genForm('Invoice')">INVOICE</div>
                <div class="form-card" onclick="genForm('Quote Form')">QUOTE FORM</div>
            </div>
        </div>
    </div>

    <div id="history" class="view-section">
        <div id="history-list"></div>
    </div>

</div>

<div class="sticky-footer">
    <div><div style="font-size:9px; color:#aaa;">TOTAL SQM</div><div id="tA" style="font-size:20px; font-weight:900; color:var(--gs)">0.000</div></div>
    <div onclick="savePoint()" style="background:var(--gs); color:#000; padding:10px 20px; border-radius:20px; font-weight:900; font-size:12px;">SAVE JOB</div>
    <div><div style="font-size:9px; color:#aaa;">PARTS</div><div id="tQ" style="font-size:20px; font-weight:900; color:var(--gs)">0</div></div>
</div>

<script>
    let items = [], activeJobs = [], historyJobs = [];
    
    const clientList = ["12345ABM", "Absolute Kitchens", "Advanced Cabinetry", "AKC Kitchens", "Braw Creative", "Brian Moloney", "Cabinets & Stone", "Cabinets by Michael", "Chooka", "CKK", "Clover Doors", "Complete Style Joinery", "Concept 2 Reality", "Coronet Kitchens", "Create a Kitchen", "Creative Cabinetry", "Cutting Edge Joinery", "Driscolls Joinery", "Evolution Kitchens and Joinery", "Geoff Frost Builders", "GM Cabinets", "Grampians Joinery", "Grovedale Kitchens", "Gunning Concepts", "Hamilton Sheetmetal", "Harris Cabinets", "Howe Kitchens & Joinery", "Hy-Craft", "Jardines Cabinets", "Joinery by Jarrod", "Jonassons", "Kingston Kabinets", "Kitchens U Build", "Kyle Hendy", "Leighton Park", "Matthews Joinery", "Ocean Grove Joinery", "Onshore", "R J Walter", "Richardson Joinery", "Schier Cabinet Makers", "Snaauws Kitchens", "SRT Cabinetry", "Stawell Joinery", "Stephensons Kitchens", "T&J Kitchens", "Tony Lambert Kitchens", "Total Kitchen Solutions", "Trendset Kitchens", "Troy Turner", "Ultrabuild", "VG Cabinets", "VJS Geelong", "VJS Shepparton", "Walk in Client", "Westend Cabinetry"];
    const profileList = ["Plain (101)", "J-Mould (102)", "Sharknose (103)", "Bevelled Edge (104)", "Ashlee (201)", "Hamilton (202)", "Vertical Grooves (203)", "Tarrone (301)", "Bobby (302)", "Orford (303)", "Shaker (401)", "Shaker 45 (402)", "Shaker w/Lines (403)", "Jack (404)", "Georgia (501)", "Branxholme (502)", "Rosebrook (503)", "Benchtop", "Molding"];

    window.onload = () => {
        populateSelects();
        renderDB();
        checkNotifications();
    };

    function populateSelects() {
        const cli = document.getElementById('cli');
        clientList.sort().forEach(c => { let o = document.createElement('option'); o.innerText=c; cli.appendChild(o); });
    }

    function tab(t) {
        document.querySelectorAll('.view-section, .nav-btn').forEach(x => x.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        document.getElementById('btn-' + t).classList.add('active');
        if(t === 'schedule') renderSchedule();
        if(t === 'history') renderHistory();
        checkNotifications();
    }

    function subTab(t) {
        document.querySelectorAll('.sub-section, .sub-btn').forEach(x => { x.style.display = 'none'; x.classList.remove('active'); });
        document.getElementById('sub-' + t).style.display = 'block';
        document.getElementById('sub-btn-' + t).classList.add('active');
    }

    function checkAutoSch() {
        const d = document.getElementById('dRec').value;
        const jn = document.getElementById('jN').value;
        const cli = document.getElementById('cli').value;
        if(d && jn) {
            const rec = new Date(d);
            const job = {
                id: jn, client: cli, start: d,
                measure: addDays(rec, 2), undercoat: addDays(rec, 14), finish: addDays(rec, 21),
                complete: false, items: [...items]
            };
            activeJobs.push(job);
            notify("Schedule Activated");
            checkNotifications();
        }
    }

    function addDays(d, days) { let r = new Date(d); r.setDate(r.getDate() + days); return r.toISOString().split('T')[0]; }

    function renderSchedule() {
        const list = document.getElementById('schedule-list');
        list.innerHTML = activeJobs.filter(j => !j.complete).map((j, i) => `
            <div class="card sch-card ${isUrgent(j.measure) ? 'urgent' : ''}">
                <div style="font-weight:900;">${j.client} (#${j.id})</div>
                <div class="sch-grid">
                    <div class="sch-item"><label>MEASURE</label><input type="date" class="sch-date" value="${j.measure}"></div>
                    <div class="sch-item"><label>UNDERCOAT</label><input type="date" class="sch-date" value="${j.undercoat}"></div>
                    <div class="sch-item"><label>COMPLETED</label><input type="date" class="sch-date" value="${j.finish}"></div>
                </div>
                <button onclick="markComplete(${i})" style="width:100%; background:#34c759; color:#fff; border:none; padding:10px; border-radius:8px; font-weight:900; margin-top:10px;">MARK COMPLETE</button>
            </div>
        `).join('') || '<div class="card">No active schedules.</div>';
    }

    function markComplete(idx) {
        activeJobs[idx].complete = true;
        historyJobs.push(activeJobs[idx]);
        notify("Job Closed & Moved to History");
        renderSchedule();
        checkNotifications();
    }

    function checkNotifications() {
        const bar = document.getElementById('notif-bar');
        const urgent = activeJobs.filter(j => !j.complete && isUrgent(j.measure));
        if(urgent.length > 0) {
            bar.innerText = `⚠️ ${urgent[0].client} (#${urgent[0].id}) DUE IN < 48 HOURS!`;
            bar.style.display = 'block';
        } else { bar.style.display = 'none'; }
    }

    function isUrgent(d) {
        const diff = (new Date(d) - new Date()) / (1000 * 60 * 60 * 24);
        return diff <= 2 && diff >= -1;
    }

    function renderDB() {
        const cL = document.getElementById('list-clients');
        cL.innerHTML = clientList.sort().map(c => `<div class="db-item">${c}</div>`).join('');
        const pL = document.getElementById('list-profiles');
        pL.innerHTML = profileList.map(p => `<div class="db-item">${p}</div>`).join('');
    }

    function renderHistory() {
        document.getElementById('history-list').innerHTML = historyJobs.map(j => `
            <div class="card" style="opacity:0.7">
                <div style="font-weight:900;">${j.client} (#${j.id})</div>
                <div style="font-size:10px;">COMPLETED ON: ${j.finish}</div>
            </div>
        `).join('') || '<div class="card">No history yet.</div>';
    }

    function up() {
        const h = document.getElementById('h').value, w = document.getElementById('w').value;
        document.getElementById('liveSq').innerText = ((h * w) / 1000000).toFixed(3);
    }

    function addPart() {
        const h = document.getElementById('h').value, w = document.getElementById('w').value, q = parseInt(document.getElementById('qty').value);
        if(!h || !w) return;
        items.push({h, w, qty: q, sqm: (h*w/1000000).toFixed(3)});
        renderItems();
        notify("Part Added");
    }

    function renderItems() {
        const l = document.getElementById('list'); l.innerHTML = '';
        let tA = 0, tQ = 0;
        items.forEach((it, i) => {
            tA += parseFloat(it.sqm) * it.qty; tQ += it.qty;
            l.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>${it.qty}x</b> ${it.h}x${it.w}</div>
                <div style="font-weight:900;">${it.sqm}</div>
            </div>`;
        });
        document.getElementById('tA').innerText = tA.toFixed(3);
        document.getElementById('tQ').innerText = tQ;
    }

    function genForm(type) { alert("Generating " + type + " for Job #" + (document.getElementById('jN').value || 'Unknown')); }
    function notify(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none', 2000); }
    function savePoint() { notify("Global Save Point Created"); }
    function tE(el) { el.classList.toggle('active'); }
    function setP(t) {
        document.querySelectorAll('.p-card').forEach(c => c.classList.remove('active'));
        document.getElementById('p' + (t==='Panel'?'P':(t==='Door'?'D':(t==='Drawer'?'Dr':'C')))).classList.add('active');
    }
</script>
</body>
</html>
