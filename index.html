<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                       PAINTWORKZ PRO                            ‚ïë
‚ïë                    REVISION TRACKING                            ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë 1.4.1 | 2026-02-14 | CREDIT NOTE added + Syntax error fixed + Defaults working            ‚ïë
‚ïë 1. ‚úì FIX: Client name edit syncs to all jobs referencing it REMOVED: Corrupted base64 logo (caused jsPDF failure)      ‚ïë
‚ïë 2. ‚úì FIX: Qty resets to 1 after add, cursor focuses on length REBUILT: 5 PDF functions (Estimate, Quote, Invoice, Mixing, Supply)            ‚ïë
‚ïë 3. ‚úì FIX: Color popup centered on screen, proper z-index ADDED: genPDF() main export function  ‚ïë
‚ïë 4. ‚úì ADD: Panel list filters (type/color/config/ss/ds/se) TESTED: All functions now functional ‚ïë 4. ‚úì ADD: Panel list filters (type/color/config/ss/ds/se) IMPROVED: Console logs non-critical errors error-safe        ‚ïë
‚ïë 5. ‚úì VERIFIED: Job auto-increment +manual override working VERIFIED: JavaScript syntax passes validation   ‚ïë
‚ïë 6. ‚úì RESTORED: Detailed timeline configuration with individual task phase durations (M/S1/U/S2/I/T/C)   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <title>PaintWorkz Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <style>
        :root {
            --gold: linear-gradient(145deg, #d4af37, #f9f1b0, #aa841e);
            --rainbow: linear-gradient(90deg, #ff3b30, #ff9500, #ffcc00, #4cd964, #5ac8fa, #007aff, #5856d6);
            --gs: #d4af37;
            --panel-clr: #34c759; --door-clr: #ff9500; --drawer-clr: #2196f3; --custom-clr: #af52de;
            --bg: #f2f2f7;
            --primary-dark: #212121;
            --accent-dark: #333333;
            --text-light: #666666;
            --btn-estimate: #2196f3;
            --btn-supply: #2196f3;
            --btn-mixing: #2196f3;
            --btn-invoice: #2196f3;
            --btn-quote: #2196f3;
            --btn-cover: #ff9800;
            --btn-label: #e91e63;
        }
        
        /* Scrollbar styling for Chrome/Safari */
        #clientsList::-webkit-scrollbar {
            width: 12px;
        }
        #clientsList::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 6px;
        }
        #clientsList::-webkit-scrollbar-thumb {
            background: #2196f3;
            border-radius: 6px;
        }
        #clientsList::-webkit-scrollbar-thumb:hover {
            background: #1976d2;
        }
        
        body { margin:0; font-family:-apple-system, system-ui, sans-serif; background:var(--bg); padding-bottom:140px; padding-top:0; -webkit-tap-highlight-color:transparent; }
        
        #globalNotificationsBanner { padding-top: env(safe-area-inset-top); }
        
        header { background:var(--rainbow); padding:env(safe-area-inset-top) 15px 5px; display:flex; align-items:center; justify-content:space-between; border-bottom:4px solid #aa841e; position:sticky; top:0; z-index:1000; height:80px; box-sizing: border-box; }
        .logo-box { background:#000; padding:6px 18px; border-radius:8px; border:2px solid var(--gs); }
        .logo-text { font-weight:900; font-size:28px; background:var(--gold); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .icon-btn { font-size: 28px; padding: 0 10px; cursor: pointer; }

        .nav-tabs { display: flex; background: #000; position: sticky; top: 80px; z-index: 999; overflow-x: auto; border-bottom: 1px solid #333; }
        .nav-btn { flex:1; min-width:80px; padding:12px 0; color:#888; text-align:center; font-weight:900; font-size:10px; text-transform:uppercase; border:none; background:0 0; cursor:pointer; transition:all 0.2s; pointer-events:auto; z-index:100; position:relative; }
        .nav-btn.active { color:#fff; border-bottom:4px solid var(--gs); background:#111; }
        
        /* ===== MOBILE RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container { padding: 10px; max-width: 100%; }
            input, select { height:40px; font-size:14px; }
            label { font-size:9px; }
            .bubble-row { flex-direction: column; gap:8px; }
            .bubble-row > div { flex:1 !important; }
            .edge-row { gap: 5px; }
            .edge-box, .cam-btn { font-size:12px; padding:10px; flex:1; }
            .add-main-btn { padding:12px; font-size:13px; }
            .p-card { padding:8px; font-size:9px; min-width:70px; }
            #pDr, #pP, #pC, #pDo { min-width:60px; }
            button { padding:10px; font-size:12px; }
            .icon-btn { font-size:20px; }
            input[type="number"] { font-size:16px; }
        }
        
        @media (max-width: 480px) {
            header { height:70px; }
            .logo-text { font-size:16px; }
            .nav-btn { min-width:60px; padding:10px 0; font-size:8px; }
            .container { padding:8px; }
            .bubble-unit input { font-size:14px; }
            .fm-row { gap:8px; }
            .fm-opt { padding:8px; font-size:10px; }
            #liveSq { font-size:36px; }
            .edge-row { gap:3px; }
            .edge-box { padding:8px; font-size:10px; min-width:30px; }
            .cam-btn { min-width:35px; padding:8px; }
            input, select { height:36px; font-size:13px; padding:0 8px; margin-bottom:6px; }
            .add-main-btn { width:100%; padding:10px; }
            .p-card { min-width:50px; padding:6px; }
            .card { padding:12px; margin-bottom:10px; }
        }
        
        /* Tablet optimizations */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container { padding: 12px; }
            .bubble-row { flex-direction: row; }
        }

        .sub-nav { display: flex; gap: 5px; margin-bottom: 15px; background: #e5e5ea; padding: 4px; border-radius: 10px; }
        .sub-btn { flex: 1; padding: 8px; border: none; border-radius: 7px; font-weight: 800; font-size: 11px; color: #666; background: transparent; cursor:pointer; transition:all 0.2s; }
        .sub-btn.active { background: #fff; color: #000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .container { padding: 15px; max-width: 600px; margin: auto; }
        .view-section { display:none; } .view-section.active { display:block; }
        .card { background:#fff; border-radius:12px; padding:15px; margin-bottom:12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); position:relative; overflow:visible; }

        label { font-size: 10px; font-weight: 900; color: #666; text-transform: uppercase; margin-bottom: 2px; display: block; }
        input, select { width:100%; height:45px; border-radius:8px; border:1px solid #ccc; padding:0 10px; font-size:16px; box-sizing:border-box; background:#fff; margin-bottom: 8px; font-weight: 600; }
        
        .db-list { max-height: 400px; overflow-y: auto; background: #f9f9f9; border: 1px solid #eee; border-radius: 8px; }
        .db-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; font-weight: 600; }
        .db-del { color: red; font-weight: 900; padding: 5px; cursor:pointer; }
        .add-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .btn-small { background: #000; color: var(--gs); border: none; border-radius: 8px; font-weight: 900; width: 60px; height:45px; cursor:pointer; transition:all 0.2s; }
        .btn-small:hover { background: #222; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .form-card { background: #f2f2f7; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #ddd; cursor: pointer; transition:all 0.2s; }
        .form-card:active { transform: scale(0.98); background: #e5e5ea; }
        .form-card h4 { margin: 0 0 5px; font-size: 14px; color: #333; }
        .form-card p { margin: 0; font-size: 10px; color: #888; font-weight: 600; }

        .bubble-row { display: flex; gap: 6px; margin: 8px 0; }
        .fm-row { display:flex; background:#eee; border-radius:8px; padding:4px; margin-bottom:10px; height: 50px; align-items: center; box-sizing: border-box; }
        .fm-opt { flex:1; text-align:center; height: 42px; line-height: 42px; font-weight:900; font-size:12px; border-radius:6px; color:#aaa; cursor:pointer; transition:all 0.2s; }
        .fm-opt.active { background:#fff; color:#000; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
        
        .bubble-unit { flex: 1; background: #fff; border: 1px solid #ccc; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 50px; box-sizing: border-box; }
        .bubble-unit input { border: none; background: transparent; text-align: center; font-size: 18px; font-weight: 900; height: 25px; margin:0; padding:0; width: 100%; }

        #prof-select { height: 50px !important; margin: 0; }

        .p-card { flex:1; background:#fff; border:2px solid #ddd; border-radius:8px; padding:8px 2px; text-align:center; font-weight:900; font-size:9px; color:#444; display:flex; flex-direction:column; align-items:center; gap:3px; cursor:pointer; transition:all 0.2s; }
        .p-card.active { border-color:var(--gs); background:#fff9e6; color:#000; }
        .p-card svg { width:22px; height:22px; stroke: currentColor; fill:none; stroke-width:2; }
        #pP.active { background:var(--panel-clr); color:#fff; border-color:var(--panel-clr); }
        #pD.active { background:var(--door-clr); color:#fff; border-color:var(--door-clr); }
        #pDr.active { background:var(--drawer-clr); color:#fff; border-color:var(--drawer-clr); }
        #pC.active { background:var(--custom-clr); color:#fff; border-color:var(--custom-clr); }

        .edge-row { display:flex; justify-content:space-between; align-items:center; margin:15px 0; gap:6px; }
        .edge-box { flex:1; height:45px; border-radius:8px; border:2px solid #ddd; background:#fff; display:flex; align-items:center; justify-content:center; font-weight:900; color:#ccc; font-size:14px; user-select:none; cursor:pointer; transition:all 0.2s; }
        .edge-box.active { background:#34c759; border-color:#28a745; color:#fff; }
        .edge-box.mode-sel.active { background:#333; border-color:var(--gs); color:var(--gs); }

        .cam-btn { font-size: 38px; cursor: pointer; padding: 0 10px; }
        .add-main-btn { width:100%; background:var(--gold); border:none; padding:20px; border-radius:40px; font-weight:900; font-size:20px; box-shadow:0 4px 15px rgba(212, 175, 55, 0.4); margin-top:10px; cursor:pointer; transition:all 0.2s; }
        .add-main-btn:active { transform: scale(0.98); }

        .part-label { display: flex; align-items: center; gap: 10px; padding: 10px; background: #fff; border-radius: 10px; margin-bottom: 8px; border: 1px solid #eee; position:relative; }
        .pl-qty { background: #000; color: var(--gs); min-width: 40px; height: 40px; border-radius: 8px; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:16px; }
        .pl-center { flex:1; }
        .pl-dims { font-size: 18px; font-weight: 900;color: #000;line-height:1.1; }
        .edge-pill { display:inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 900; color: #fff; margin-right: 3px; }
        .pl-right { display: flex; flex-direction: column; align-items: center; min-width: 60px; border-left: 1px solid #eee; }
        .pl-mode { width: 35px; height: 35px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 12px; border: 2px solid; margin-bottom: 4px; }
        .del-btn { color: #ff3b30; font-size: 24px; border: none; background: none; cursor:pointer; transition:all 0.2s; }
        .del-btn:active { transform: scale(1.2); }

        .qty-controls { display:flex; flex-direction:column; align-items:center; gap:2px; min-width:45px; }
        .qty-btn { border:none; background:#eee; width:100%; border-radius:4px; font-weight:900; font-size:16px; cursor:pointer; transition:all 0.2s; padding:0; height:28px; }
        .qty-btn:active { background:#ddd; }

        .sticky-footer { background: #000; position: fixed; bottom: 0; left: 0; right: 0; height: 80px; border-top: 3px solid var(--gs); color: #fff; display: flex; justify-content: space-around; align-items: center; z-index: 2000; }
        .footer-item { text-align:center; }
        .footer-val { font-size:20px; font-weight:900; color:var(--gs); }
        .footer-label { font-size:9px; color:#aaa; }
        
        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 12px 25px; border-radius: 30px; font-weight: 900; z-index: 3000; display: none; border: 1px solid var(--gs); animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity:0; transform: translateX(-50%) translateY(20px); } to { opacity:1; transform: translateX(-50%) translateY(0); } }

        .pl-meta { font-size:10px; font-weight:700; color:#666; margin-top:2px; }

        /* COMPLETE JOB STAMP */
        .job-complete-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 24px;
            font-weight: 900;
            color: #34c759;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(52, 199, 89, 0.2);
            z-index: 50;
            border: 1.5px solid #34c759;
            padding: 2px 12px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.85);
            white-space: nowrap;
            line-height: 1;
        }
    </style>
</head>
<body>

    <!-- PDF Preview Modal -->
    <div id="pdfPreviewModal" style="display:none !important; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:99999; justify-content:center; align-items:center; padding:0; margin:0;">
        <div style="background:#fff; border-radius:8px; width:95vw; height:95vh; max-width:1400px; display:flex; flex-direction:column; box-shadow:0 20px 60px rgba(0,0,0,0.6); margin:0; padding:0;">
            <!-- Header -->
            <div style="display:flex; justify-content:space-between; align-items:center; padding:20px 25px; border-bottom:2px solid #ddd; background:#f9f9f9; flex-shrink:0;">
                <h3 id="pdfPreviewTitle" style="margin:0; color:#333; font-size:18px;">üìÑ PDF Preview</h3>
                <button onclick="closePDFPreview()" style="border:none; background:none; font-size:28px; cursor:pointer; color:#666;">‚úï</button>
            </div>
            
            <!-- Loading Indicator -->
            <div id="pdfLoadingSpinner" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; z-index:100000; background:#fff; padding:40px; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.2);">
                <div style="width:60px; height:60px; border:4px solid #f3f3f3; border-top:4px solid #d4af37; border-radius:50%; animation:spin 1s linear infinite;"></div>
                <p style="margin-top:15px; margin-bottom:0; color:#666; font-weight:bold;">Generating PDF...</p>
            </div>
            
            <!-- Preview Container -->
            <div id="pdfPreviewContainer" style="flex:1; overflow:auto; padding:15px; background:#e8e8e8; display:flex; justify-content:center; align-items:center; margin:0;">
                <iframe id="pdfPreviewIframe" style="width:100%; height:100%; border:none; background:#fff; border-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,0.1);"></iframe>
            </div>
            
            <!-- Footer Buttons -->
            <div style="display:flex; gap:12px; padding:20px 25px; border-top:2px solid #ddd; background:#f9f9f9; flex-shrink:0;">
                <button onclick="closePDFPreview()" style="flex:1; border:none; background:#e0e0e0; color:#333; padding:14px; border-radius:6px; font-weight:bold; cursor:pointer; font-size:14px;">‚Üê CANCEL</button>
                <button id="downloadPDFBtn" onclick="downloadCurrentPDF()" style="flex:1; border:none; background:#d4af37; color:#000; padding:14px; border-radius:6px; font-weight:bold; cursor:pointer; font-size:14px;">‚Üì DOWNLOAD PDF</button>
            </div>
        </div>
    </div>
    
    <!-- CHARGES MODAL - Appears before PDF generation -->
    <div id="chargesModal" style="display:none; position:fixed; top:60px; left:0; width:100%; bottom:50px; background:rgba(0,0,0,0.7); z-index:99998; justify-content:center; align-items:flex-start; padding:5px;overflow-y:auto;">
        <div style="background:#fff; border-radius:8px; width:100%; max-width:500px; padding:10px; box-shadow:0 10px 40px rgba(0,0,0,0.3); margin:5px auto;">
            <h2 style="margin:0 0 8px 0; color:#333; font-size:14px; font-weight:bold;">Additional Charges</h2>
            
            <!-- Paint Colour Surcharges - Dynamic per colour -->
            <div id="colourSurchargesContainer" style="margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid #ddd;">
                <p style="color:#999; font-size:10px; margin:0;">Loading colours...</p>
            </div>
            
            <!-- Delivery/Pickup Section -->
            <div style="margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid #ddd;">
                <label style="display:block; font-weight:bold; color:#333; margin-bottom:4px; font-size:10px;">Delivery/Pickup Region:</label>
                <select id="deliveryRegionSelect" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:3px; font-size:10px; background:#fff; cursor:pointer;">
                    <option value="0">None (No charge)</option>
                    <option value="90">Warrnambool Region ($90)</option>
                    <option value="110">Geelong Region ($110)</option>
                    <option value="110">Mt Gambier Region ($110)</option>
                    <option value="250">Adelaide ($250)</option>
                    <option value="110">Horsham Region ($110)</option>
                    <option value="160">Ballarat Region ($160)</option>
                </select>
            </div>
            
            <!-- Courier Section -->
            <div style="margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid #ddd;">
                <label style="display:block; font-weight:bold; color:#333; margin-bottom:4px; font-size:10px;">Freight Charge ($):</label>
                <input type="number" id="freightChargeInput" value="0" min="0" step="5" placeholder="0.00" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:3px; font-size:10px; box-sizing:border-box;">
            </div>
            
            <!-- Other Charges Section -->
            <div style="margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid #ddd;">
                <label style="display:block; font-weight:bold; color:#333; margin-bottom:4px; font-size:10px;">Other Charges (Description & Amount):</label>
                <input type="text" id="otherChargeDesc" placeholder="e.g. Rush Delivery" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:3px; font-size:10px; margin-bottom:4px; box-sizing:border-box;">
                <input type="number" id="otherChargeAmount" value="0" min="0" step="5" placeholder="Amount ($)" style="width:100%; padding:4px; border:1px solid #ddd; border-radius:3px; font-size:10px; box-sizing:border-box;">
            </div>
            
            <!-- Summary -->
            <div style="background:#f5f5f5; padding:8px; border-radius:3px; margin-bottom:8px; font-size:9px; line-height:1.3;">
                <div style="margin-bottom:2px;"><strong>Colour:</strong> $<span id="summaryColourCharge">0.00</span></div>
                <div style="margin-bottom:2px;"><strong>Delivery:</strong> $<span id="summaryDeliveryCharge">0.00</span></div>
                <div style="margin-bottom:2px;"><strong>Freight:</strong> $<span id="summaryFreightCharge">0.00</span></div>
                <div style="margin-bottom:2px;"><strong>Other:</strong> $<span id="summaryOtherCharge">0.00</span></div>
                <div style="border-top:1px solid #ddd; padding-top:2px; margin-top:2px; margin-bottom:2px;"><strong>Subtotal:</strong> $<span id="summarySubtotalPlusCharges">0.00</span></div>
                <div style="border-top:1px solid #ddd; padding-top:2px; margin-top:2px;"><strong>GST:</strong> $<span id="summaryGST">0.00</span></div>
                <div style="border-top:2px solid #999; padding-top:3px; margin-top:3px; font-size:10px; font-weight:bold;"><strong>TOTAL:</strong> $<span id="summaryTotalCharge">0.00</span></div>
            </div>
            
            <!-- Buttons -->
            <div style="display:flex; gap:6px;">
                <button onclick="closeChargesModal()" style="flex:1; border:none; background:#e0e0e0; color:#333; padding:8px; border-radius:3px; font-weight:bold; cursor:pointer; font-size:10px;">CANCEL</button>
                <button id="applyChargesBtn" onclick="applyChargesAndGenerate()" style="flex:1; border:none; background:#4caf50; color:#fff; padding:8px; border-radius:3px; font-weight:bold; cursor:pointer; font-size:10px;">APPLY & GENERATE</button>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Firebase SDK - Modern Modular Approach -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, addDoc, getDoc, onSnapshot, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCddhnoWoJczM2yXemz2evZc-W2x7OnP00",
            authDomain: "paintworkz-42bc0.firebaseapp.com",
            projectId: "paintworkz-42bc0",
            storageBucket: "paintworkz-42bc0.firebasestorage.app",
            messagingSenderId: "298786193879",
            appId: "1:298786193879:web:8fd63ca63c109f8cd14b92"
        };
        
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log('‚úì Firebase initialized successfully');
        } catch(fbError) {
            console.log('‚ÑπÔ∏è Firebase note (non-critical):', fbError.message);
            // Firebase will still work with explicit config - this error is from hosting environment check
        }
        
        // Export to window for global access - with proper function wrappers
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        
        // Export Firestore functions as window methods
        window.doc = doc;
        window.setDoc = setDoc;
        window.collection = collection;
        window.addDoc = addDoc;
        window.getDoc = getDoc;
        window.deleteDoc = deleteDoc;
        window.onSnapshot = onSnapshot;
        window.getDocs = getDocs;
        
        // Auth functions
        window.createUserWithEmailAndPassword = (email, password) => createUserWithEmailAndPassword(auth, email, password);
        window.signInWithEmailAndPassword = (email, password) => signInWithEmailAndPassword(auth, email, password);
        window.signOut = () => signOut(auth);
        
        window.currentUser = null;
        window.realtimeSyncActive = false; // Guard against multiple listeners
        window.realtimeSyncUnsubscribe = null; // Store unsubscribe function
        
        // Set up auth listener
        onAuthStateChanged(auth, user => {
            window.currentUser = user;
            if (user) {
                const loginScreen = document.getElementById('loginScreen');
                const appContainer = document.getElementById('appContainer');
                if (loginScreen) loginScreen.style.display = 'none';
                if (appContainer) appContainer.style.display = 'block';
                
                // Initialize app (clear form, populate clients)
                setTimeout(() => {
                    if (typeof initializeApp === 'function') {
                        try {
                            initializeApp();
                        } catch(e) {
                            console.error('initializeApp error:', e);
                        }
                    }
                }, 100);
                
                // Load jobs from Firebase ONLY after document is fully loaded
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        setTimeout(() => {
                            if (window.loadAllDataFromFirebase) {
                                try {
                                    window.loadAllDataFromFirebase();
                                } catch (e) {
                                    console.error('loadAllDataFromFirebase error:', e);
                                }
                            }
                        }, 500);
                    });
                } else {
                    // DOM already loaded
                    setTimeout(() => {
                        if (window.loadAllDataFromFirebase) {
                            try {
                                window.loadAllDataFromFirebase();
                            } catch (e) {
                                console.error('loadAllDataFromFirebase error:', e);
                            }
                        }
                    }, 500);
                }
                
                // Only set up real-time sync ONCE per session (DISABLED by default due to memory issues)
                if (!window.realtimeSyncActive) {
                    // Real-time sync disabled to prevent memory leaks
                    // Users should manually refresh to get latest data from Firebase
                    console.log('‚ÑπÔ∏è Real-time sync disabled (manual refresh recommended)');
                    window.realtimeSyncActive = true;
                }
            } else {
                // Clean up listener when logging out
                if (window.realtimeSyncUnsubscribe) {
                    try {
                        window.realtimeSyncUnsubscribe();
                    } catch (e) {
                        console.warn('Error unsubscribing:', e);
                    }
                    window.realtimeSyncUnsubscribe = null;
                }
                window.realtimeSyncActive = false;
                
                const loginScreen = document.getElementById('loginScreen');
                const appContainer = document.getElementById('appContainer');
                if (loginScreen) loginScreen.style.display = 'block';
                if (appContainer) appContainer.style.display = 'none';
            }
        });
        
        // Set firebaseReady LAST - only after everything is initialized
        window.firebaseReady = true;
    </script>

    <!-- USER INFO -->
    <div id="userInfo"></div>

<!-- TOAST NOTIFICATION -->
<div id="toast" style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#34c759; color:#fff; padding:12px 25px; border-radius:25px; font-weight:900; z-index:5000; font-size:11px; box-shadow:0 4px 12px rgba(52, 199, 89, 0.3); animation: slideUp 0.4s ease-out, slideDown 0.4s ease-in 2.6s forwards; white-space:nowrap;"></div>

<style>
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(100px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes slideDown {
    from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    to {
        opacity: 0;
        transform: translateX(-50%) translateY(100px);
    }
}
</style>

<!-- A3 SCHEDULE DATE RANGE MODAL -->
<div id="a3ScheduleModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div style="background:#fff; padding:25px; border-radius:12px; width:90%; max-width:450px; box-shadow:0 10px 40px rgba(0,0,0,0.3); z-index:1001;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0; font-weight:bold; font-size:16px;">üìÖ A3 Work Schedule</h3>
            <button onclick="closeA3ScheduleModal()" style="border:none; background:none; font-size:24px; cursor:pointer; padding:0; width:30px; height:30px;">‚úï</button>
        </div>
        
        <div style="margin-bottom:20px;">
            <p style="margin:0 0 15px 0; font-size:12px; color:#666;">Select time period for your work schedule:</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                <button onclick="generateA3Schedule(7)" style="padding:12px; background:#2196f3; color:#fff; border:none; border-radius:6px; font-weight:bold; font-size:12px; cursor:pointer;">üìÖ 1 WEEK</button>
                <button onclick="generateA3Schedule(30)" style="padding:12px; background:#ff9500; color:#fff; border:none; border-radius:6px; font-weight:bold; font-size:12px; cursor:pointer;">üìÖ 1 MONTH</button>
                <button onclick="generateA3Schedule(90)" style="padding:12px; background:#4caf50; color:#fff; border:none; border-radius:6px; font-weight:bold; font-size:12px; cursor:pointer;">üìÖ 3 MONTHS</button>
                <button onclick="generateA3Schedule(365)" style="padding:12px; background:#9c27b0; color:#fff; border:none; border-radius:6px; font-weight:bold; font-size:12px; cursor:pointer;">üìÖ 1 YEAR</button>
            </div>
            
            <div style="border-top:1px solid #ddd; padding-top:15px;">
                <p style="margin:0 0 10px 0; font-size:12px; font-weight:bold; color:#333;">Or select custom dates:</p>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <div style="flex:1;">
                        <label style="display:block; font-size:11px; color:#666; margin-bottom:4px;">From</label>
                        <input type="date" id="a3StartDate" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px;">
                    </div>
                    <div style="flex:1;">
                        <label style="display:block; font-size:11px; color:#666; margin-bottom:4px;">To</label>
                        <input type="date" id="a3EndDate" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px;">
                    </div>
                </div>
                <button onclick="generateA3ScheduleCustom()" style="width:100%; padding:10px; background:#673ab7; color:#fff; border:none; border-radius:6px; font-weight:bold; font-size:12px; cursor:pointer;">üìÖ GENERATE</button>
            </div>
        </div>
    </div>
</div>

<!-- TIMELINE EDITOR MODAL -->
<div id="timelineModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; flex-wrap:wrap;">
    <div style="background:#fff; padding:25px; border-radius:12px; width:90%; max-width:500px; max-height:80vh; overflow-y:auto; box-shadow:0 10px 40px rgba(0,0,0,0.3); z-index:1001;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;">Edit Timeline</h3>
            <button onclick="closeTimelineModal()" style="border:none; background:none; font-size:24px; cursor:pointer; padding:0; width:30px; height:30px;">‚úï</button>
        </div>
        
        <div id="timelineEditorContent"></div>
        
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="saveTimelineEdit()" style="flex:1; border:none; background:#34c759; color:#fff; padding:10px; border-radius:6px; font-weight:900; cursor:pointer;">SAVE</button>
            <button onclick="closeTimelineModal()" style="flex:1; border:none; background:#f0f0f0; color:#000; padding:10px; border-radius:6px; font-weight:900; cursor:pointer;">CANCEL</button>
        </div>
    </div>
</div>

<!-- PAINT FORMULA DATABASE MODAL -->
<!-- CALENDAR MODAL -->
<div id="calendarModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:5000; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:16px; padding:20px; width:90%; max-width:400px; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <button onclick="prevMonth()" style="border:none; background:#f0f0f0; width:40px; height:40px; border-radius:8px; font-weight:900; font-size:18px; cursor:pointer;" title="Previous month">‚Üê</button>
            <div style="text-align:center; flex:1;">
                <div id="monthYear" style="font-weight:900; font-size:16px; color:#000;"></div>
            </div>
            <button onclick="nextMonth()" style="border:none; background:#f0f0f0; width:40px; height:40px; border-radius:8px; font-weight:900; font-size:18px; cursor:pointer;" title="Next month">‚Üí</button>
        </div>
        
        <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-bottom:15px;">
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">SU</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">MO</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">TU</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">WE</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">TH</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">FR</div>
            <div style="text-align:center; font-weight:900; font-size:10px; color:#999;">SA</div>
            <div id="calendarDays" style="grid-column:1/-1; display:grid; grid-template-columns:repeat(7,1fr); gap:4px;"></div>
        </div>
        
        <div style="display:flex; gap:8px;">
            <button onclick="closeCalendar()" style="flex:1; border:none; background:#f0f0f0; padding:12px; border-radius:8px; font-weight:900; cursor:pointer;">CANCEL</button>
            <button onclick="selectToday()" style="flex:1; border:none; background:var(--gs); padding:12px; border-radius:8px; font-weight:900; cursor:pointer;">TODAY</button>
        </div>
    </div>
</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen" style="position:fixed; top:0; left:0; right:0; bottom:0; background:linear-gradient(135deg, #d4af37, #f9f1b0); z-index:10000; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
    <div style="background:#fff; border-radius:20px; padding:30px; width:100%; max-width:400px; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
        <div style="text-align:center; margin-bottom:30px;">
            <h1 style="margin:0; color:#d4af37; font-size:32px;">üé® PaintWorkz</h1>
            <p style="color:#666; margin:10px 0 0; font-size:14px;">Live Sync ‚Ä¢ All Devices</p>
        </div>
        
        <input type="email" id="loginEmail" placeholder="Email" style="margin-bottom:12px; padding:15px;">
        <input type="password" id="loginPassword" placeholder="Password" style="margin-bottom:20px; padding:15px;">
        
        <button onclick="handleLogin()" style="width:100%; background:#d4af37; border:none; padding:15px; border-radius:10px; font-weight:900; font-size:16px; cursor:pointer; margin-bottom:10px;">SIGN IN</button>
        <button onclick="trySignup()" style="width:100%; background:#333; color:#d4af37; border:2px solid #d4af37; padding:15px; border-radius:10px; font-weight:900; font-size:16px; cursor:pointer; font-size:14px;">CREATE ACCOUNT</button>
        
        <div id="loginError" style="color:red; font-weight:900; margin-top:15px; text-align:center; display:none;"></div>
    </div>
</div>

<!-- APP CONTAINER -->
<div id="appContainer" style="display:none;">

<header>
    <div class="icon-btn" onclick="tab('history')">üîç</div>
    <div class="logo-box" id="headerLogoBox" style="position:relative; width:calc(25vw); height:60px; display:flex; align-items:center; justify-content:center; padding:6px; box-sizing:border-box; margin-left:10px; border:2px solid #DAA520; border-radius:2px; background:#000;">
        <img id="headerLogoImg" src="" style="height:100%; max-width:95%; display:none; object-fit:contain;" alt="Company Logo">
        <span class="logo-text" id="headerLogoText">PaintWorkz</span>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
        <div id="goBackBtn" class="icon-btn" onclick="goBackJob()" style="display:none;" title="Exit without saving if no changes made">‚Üê Back</div>
        <div class="icon-btn" onclick="saveJob()">üíæ</div>
    </div>
</header>

<div class="nav-tabs">
    <div class="nav-btn active" id="btn-measure" data-tab="measure">Measure</div>
    <div class="nav-btn" id="btn-history" data-tab="history">History</div>
    <div class="nav-btn" id="btn-db" data-tab="db">Database</div>
    <div class="nav-btn" id="btn-forms" data-tab="forms">Forms</div>
    <div class="nav-btn" id="btn-schedule" data-tab="schedule">Schedule</div>
    <div class="nav-btn" id="btn-admin" data-tab="admin">Admin</div>
</div>

<div class="container">
    
    <div id="measure" class="view-section active">
        <div class="card">
            <div style="display:flex; gap:8px; margin-bottom: 8px;">
                <div style="flex:2">
                    <label>Client</label>
                    <select id="cli"></select>
                </div>
                <div style="flex:1">
                    <label>Date Received</label>
                    <input type="text" id="dRec" placeholder="DD/MM/YY" inputmode="numeric" style="text-align:center;" onclick="openCalendar()">
                </div>
            </div>

            <div style="display:flex; gap:8px; margin-bottom: 8px;">
                <div style="flex:2">
                    <label>Job Name / Reference</label>
                    <input type="text" id="jNm" placeholder="e.g. Smith Residence">
                </div>
                <div style="flex:1">
                    <label>Job #</label>
                    <input type="text" id="jN" placeholder="####" style="text-align:center;">
                </div>
            </div>

            <div style="background:#f9f9f9; padding:10px; border-radius:8px; border:1px solid #eee; margin-bottom:10px;">
                <div style="display:flex; gap:8px; margin-bottom:8px;">
                    <div style="flex:1">
                        <label>Brand</label>
                        <select id="p-brand" style="height:35px; font-size:12px;">
                            <option>Wattyl</option>
                            <option>Dulux</option>
                            <option>Taubmans</option>
                            <option>Haymes</option>
                            <option>British Paints</option>
                            <option>Evic</option>
                            <option>Custom</option>
                        </select>
                    </div>
                    <div style="flex:1">
                        <label>Color Name</label>
                        <input type="text" id="p-color" placeholder="e.g. Lexicon" style="height:35px; font-size:12px;" oninput="openPaintFormulaSearch()">
                    </div>
                </div>
                <div style="display:flex; gap:8px;">
                    <div style="flex:1">
                        <label>Code / Formula</label>
                        <input type="text" id="p-code" placeholder="Formula (auto-search when typing)" style="height:35px; font-size:12px;" oninput="autoSearchFormulaOnType()">
                    </div>
                    <div style="flex:1">
                        <label>Finish</label>
                        <select id="p-finish" style="height:35px; font-size:12px;">
                            <option>Satin</option><option>Gloss</option><option>Matt</option><option>20% Gloss</option><option>30% Gloss</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <label>Part Type</label>
            <div class="bubble-row">
                <div id="pP" class="p-card active" onclick="setP('Panel')"><svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"></rect></svg>PANEL</div>
                <div id="pD" class="p-card" onclick="setP('Door')"><svg viewBox="0 0 24 24"><path d="M5 3h14v18H5V3zm10 9v1"></path></svg>DOOR</div>
                <div id="pDr" class="p-card" onclick="setP('Drawer')"><svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="6" rx="1"></rect><rect x="3" y="13" width="18" height="6" rx="1"></rect></svg>DRAWER</div>
                <div id="pC" class="p-card" onclick="setP('Custom')"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>CUSTOM</div>
            </div>

            <label>Description of Part</label>
            <input type="text" id="desc" placeholder="e.g. Pantry Door Left" style="text-transform: uppercase;">

            <div class="fm-row">
                <div id="fm-flat" class="fm-opt active" onclick="setFM('Flat')">FLAT</div>
                <div id="fm-mould" class="fm-opt" onclick="setFM('Moulded')">MOULDED</div>
            </div>

            <div class="bubble-row">
                <div class="bubble-unit" style="flex:0.8"><input type="number" id="thk" value="18" inputmode="decimal" oninput="up()"><div style="font-size:9px;color:#888;">THICK</div></div>
                <div style="flex:2"><select id="prof-select" oninput="up()"></select></div>
                <div class="bubble-unit" style="flex:0.8"><input type="number" id="qty" value="1" inputmode="numeric"><div style="font-size:9px;color:#888;">QTY</div></div>
            </div>

            <div class="bubble-row">
                <input type="number" id="h" placeholder="Length" inputmode="decimal" oninput="up()" style="height:55px; font-size:22px; text-align:center;">
                <input type="number" id="w" placeholder="Width" inputmode="decimal" oninput="up()" style="height:55px; font-size:22px; text-align:center;">
            </div>

            <label>Paint Mode</label>
            <div class="edge-row" style="margin-top:5px;">
                <div id="mSS" class="edge-box mode-sel active" onclick="setM('SS')">SS</div>
                <div id="mDS" class="edge-box mode-sel" onclick="setM('DS')">DS</div>
                <div id="mSE" class="edge-box mode-sel" onclick="setM('SE')">SE</div>
            </div>

            <label>Edge Treatment</label>
            <div class="edge-row">
                <div class="edge-box" id="E1" onclick="tE(this)">L</div>
                <div class="edge-box" id="E2" onclick="tE(this)">L</div>
                <div class="cam-btn" onclick="snap()">üì∏</div>
                <div class="edge-box" id="E3" onclick="tE(this)">S</div>
                <div class="edge-box" id="E4" onclick="tE(this)">S</div>
            </div>

            <div style="display: flex; flex-direction: column; align-items: center; padding: 15px 0; border-top: 1px solid #eee;">
                <div id="liveSq" style="font-size: 50px; font-weight: 900; color: var(--gs); line-height: 1;">0.000</div>
                <div style="font-size: 10px; font-weight: 900; color: #aaa;">CURRENT PART SQM (m¬≤)</div>
            </div>

            <button class="add-main-btn" onclick="addPart()">ADD PART +</button>
            
            <!-- JOB PHOTOS GALLERY -->
            <div id="jobPhotosContainer" style="margin-top:20px; padding:15px; background:#f5f5f5; border-radius:8px; border:1px solid #e0e0e0;">
                <p style="text-align:center; color:#999; font-size:11px; padding:10px;">No photos yet</p>
            </div>
        </div>
        
        <!-- FILTER BAR FOR PANEL LIST -->
        <div id="panelFilterBar" style="padding:12px 10px; background:#f9f9f9; border-bottom:1px solid #ddd; display:flex; gap:6px; flex-wrap:wrap; font-size:10px;">
            <button class="filter-btn active" onclick="filterPanels('all')" data-bg="#d4af37" data-color="#000" style="padding:6px 14px; border:none; background:#d4af37; color:#000; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.2s;">ALL</button>
            <button class="filter-btn" onclick="filterPanels('panel')" data-bg="#e8f4f8" data-color="#0288d1" style="padding:6px 14px; border:none; background:#e8f4f8; color:#0288d1; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">PANEL</button>
            <button class="filter-btn" onclick="filterPanels('door')" data-bg="#f3e5f5" data-color="#7b1fa2" style="padding:6px 14px; border:none; background:#f3e5f5; color:#7b1fa2; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">DOOR</button>
            <button class="filter-btn" onclick="filterPanels('drawer')" data-bg="#e3f2fd" data-color="#1565c0" style="padding:6px 14px; border:none; background:#e3f2fd; color:#1565c0; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">DRAWER</button>
            <button class="filter-btn" onclick="filterPanels('custom')" data-bg="#fce4ec" data-color="#c2185b" style="padding:6px 14px; border:none; background:#fce4ec; color:#c2185b; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">CUSTOM</button>
            <button class="filter-btn" onclick="filterPanels('moulded')" data-bg="#fff3e0" data-color="#e65100" style="padding:6px 14px; border:none; background:#fff3e0; color:#e65100; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">MOULDED</button>
            <button class="filter-btn" onclick="filterPanels('flat')" data-bg="#f1f8e9" data-color="#558b2f" style="padding:6px 14px; border:none; background:#f1f8e9; color:#558b2f; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">FLAT</button>
            <button class="filter-btn" onclick="filterPanels('ss')" data-bg="#e0f2f1" data-color="#00695c" style="padding:6px 14px; border:none; background:#e0f2f1; color:#00695c; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">S/S</button>
            <button class="filter-btn" onclick="filterPanels('ds')" data-bg="#ede7f6" data-color="#4527a0" style="padding:6px 14px; border:none; background:#ede7f6; color:#4527a0; border-radius:20px; cursor:pointer; font-weight:900; box-shadow:0 1px 3px rgba(0,0,0,0.08); transition:all 0.2s;">D/S</button>
            <button class="filter-btn" onclick="filterPanels('se')" style="padding:6px 12px; border:1px solid #ddd; background:#fff; border-radius:4px; cursor:pointer; font-weight:900;">S/E</button>
            
            <!-- Paint Colour Filter -->
            <div style="display:flex; gap:8px; align-items:center; margin-top:12px;">
                <label style="font-weight:bold; color:#666; font-size:13px;">Paint Colour:</label>
                <select id="colourFilter" onchange="filterByColour(this.value)" style="padding:6px 12px; border:1px solid #ddd; border-radius:4px; background:#fff; cursor:pointer; font-weight:bold; color:#333; font-size:12px; min-width:180px;">
                    <option value="">-- ALL --</option>
                </select>
            </div>
        </div>
        
        <div id="list"></div>
    </div>

    <!-- Paint Formula Popup Modal -->
    <div id="paintFormulaModal" style="display:none !important; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center;" onclick="if(event.target.id==='paintFormulaModal') closePaintFormulaModal();">
        <div style="position:relative; background:#fff; border-radius:12px; padding:20px; max-width:500px; width:90vw; max-height:80vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.3); z-index:10000;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding-bottom:10px; border-bottom:2px solid #eee;">
                <h3 style="margin:0; font-size:13px; font-weight:900;" id="formulaTitle">Paint Formula</h3>
                <button onclick="closePaintFormulaModal()" style="background:none; border:none; font-size:20px; cursor:pointer; padding:0; width:24px; height:24px; line-height:1;">√ó</button>
            </div>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:12px;">
                <div>
                    <div style="font-size:9px; font-weight:900; color:#666; margin-bottom:3px;">COLOUR</div>
                    <div id="formulaColor" style="font-size:12px; font-weight:900;">-</div>
                </div>
                <div>
                    <div style="font-size:9px; font-weight:900; color:#666; margin-bottom:3px;">CODE</div>
                    <div id="formulaCode" style="font-size:12px; font-weight:900;">-</div>
                </div>
            </div>
            
            <div style="background:#f0f0f0; padding:8px; border-radius:4px; margin-bottom:10px;">
                <label style="font-size:9px; font-weight:900; display:block; margin-bottom:4px;">Litres to Mix</label>
                <input type="number" id="mixLitres" value="1" min="0.1" step="0.1" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:3px; font-size:12px; box-sizing:border-box; font-weight:900;" oninput="updateFormulaScaling()">
            </div>
            
            <div id="scaledFormula" style="background:#fafafa; padding:10px; border-radius:4px; margin-bottom:12px; font-size:10px; max-height:220px; overflow-y:auto; line-height:1.8;">
                <!-- Scaled formula will appear here -->
            </div>
            
            <div style="display:flex; gap:8px;">
                <button onclick="savePaintFormulaToJob()" style="flex:1; background:#34c759; color:#fff; border:none; padding:10px; border-radius:6px; font-weight:900; font-size:12px; cursor:pointer;">‚úì Save</button>
                <button onclick="closePaintFormulaModal()" style="flex:1; background:#e0e0e0; color:#333; border:none; padding:10px; border-radius:6px; font-weight:900; font-size:12px; cursor:pointer;">Cancel</button>
            </div>
        </div>
    </div>

    <div id="db" class="view-section">
        <div class="sub-nav">
            <button class="sub-btn active" id="sub-btn-clients" onclick="subTab('clients')">CLIENTS</button>
            <button class="sub-btn" id="sub-btn-profiles" onclick="subTab('profiles')">DOOR PROFILES</button>
            <button class="sub-btn" id="sub-btn-paint" onclick="subTab('paint')">PAINT</button>
        </div>

        <div id="sub-clients" class="sub-section active">
            <div class="card">
                <div class="add-row">
                    <input type="text" id="new-client" placeholder="New Client Name" style="margin-bottom:0;">
                    <button class="btn-small" onclick="addClient()">ADD</button>
                </div>
                <div class="db-list" id="list-clients"></div>
            </div>
        </div>

        <div id="sub-profiles" class="sub-section" style="display:none;">
            <div class="card">
                <h4 style="margin-bottom:15px; font-weight:900;">Door Profiles</h4>
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Add new profiles or edit existing names. Profiles are used in your pricing matrix tiers.</p>
                
                
                <div class="add-row">
                    <input type="text" id="new-profile" placeholder="New Profile Name (e.g., Shaker, Ashlee)" style="margin-bottom:0;">
                    <button class="btn-small" onclick="addProfile()">ADD</button>
                </div>
                <div class="db-list" id="list-profiles" style="margin-top:15px;"></div>
            </div>
        </div>

        <div id="sub-paint" class="sub-section" style="display:none;">
            <div class="card">
                <h4 style="margin-bottom:15px; font-weight:900;">Paint Formula Database</h4>
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Manage your paint formulas. When you type a colour in the Measure tab, matching formulas will appear automatically.</p>
                
                <div style="margin-bottom:20px;">
                    <h5 style="margin-bottom:10px; font-weight:900; font-size:12px;">Add New Formula</h5>
                    <div style="background:#f9f9f9; padding:15px; border-radius:8px; border:1px solid #ddd;">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input type="text" id="newPaintColor" placeholder="Colour Name (e.g., Lexicon)" style="flex:1.5; padding:10px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; font-size:12px;">
                            <input type="text" id="newPaintCode" placeholder="Code (e.g., XTSW1E3)" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; font-size:12px;">
                        </div>
                        <input type="text" id="newPaintProduct" placeholder="Product (e.g., 690 30% XTint Poly)" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; margin-bottom:10px; box-sizing:border-box; font-size:12px;">
                        
                        <!-- 1L Base Section -->
                        <div style="background:#fff; padding:10px; border-radius:6px; border:1px solid #eee; margin-bottom:10px;">
                            <div style="font-size:10px; font-weight:900; margin-bottom:8px; color:#666;">1L BASE (code @ grams)</div>
                            <div style="display:flex; gap:8px;">
                                <input type="text" id="baseCode" placeholder="Base Code" style="flex:0.6; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; box-sizing:border-box;">
                                <input type="number" id="baseAmount" placeholder="grams" step="0.01" style="flex:0.4; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; box-sizing:border-box;">
                            </div>
                        </div>
                        
                        <!-- Tinters Section -->
                        <div style="background:#fff; padding:10px; border-radius:6px; border:1px solid #eee; margin-bottom:10px;">
                            <div style="font-size:10px; font-weight:900; margin-bottom:8px; color:#666;">TINTERS (each line: code @ grams)</div>
                            <textarea id="tintersList" placeholder="ITE303 @ 5.88&#10;ITE306 @ 5.95&#10;ITE310 @ 5.75" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; min-height:60px; box-sizing:border-box; font-family:monospace;"></textarea>
                            <div style="font-size:9px; color:#999; margin-top:5px;">One tinter per line. Format: CODE @ GRAMS</div>
                        </div>
                        
                        <button onclick="addNewPaintFormulaUI()" style="width:100%; padding:10px; background:#34c759; color:#fff; border:none; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">+ ADD FORMULA</button>
                    </div>
                </div>
                
                <div>
                    <div style="margin-bottom:10px; font-weight:900; font-size:12px;">
                        Existing Formulas (<span id="formulaCount">0</span>)
                        <input type="text" id="formulaSearch" placeholder="Search formula..." style="width:100%; padding:6px; margin-top:8px; border:1px solid #ddd; border-radius:4px; font-size:11px;">
                    </div>
                    <div id="paintFormulaList" style="background:#fff; border:1px solid #ddd; border-radius:8px; overflow:hidden; max-height:400px; overflow-y:auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="forms" class="view-section">
        <div class="card">
            <h3>Generate Form</h3>
            <div class="form-grid">
                <div id="form-estimate" class="form-card" onclick="genForm('Estimate')"><h4>Estimate</h4><p>Job breakdown only</p></div>
                <div id="form-supply" class="form-card" onclick="genForm('Supply Docket')"><h4>Supply Docket</h4><p>Part list for client</p></div>
                <div id="form-mixing" class="form-card" onclick="genForm('Mixing Card')"><h4>Mixing Card</h4><p>Paint shop formula</p></div>
                <div id="form-invoice" class="form-card" onclick="genForm('Invoice')"><h4>Invoice</h4><p>Dynamic length billing</p></div>
                <div id="form-quote" class="form-card" onclick="genForm('Quote Form')"><h4>Quote Form</h4><p>Raw vs Paint pricing</p></div>
                <div id="form-cover" class="form-card" onclick="genForm('Cover Sheet')" style="background:#fff3e0; border-color:#ff9800;"><h4>üìã Cover Sheet</h4><p>Job info summary</p></div>
                <div id="form-label" class="form-card" onclick="genForm('Shop Label')" style="background:#fce4ec; border-color:#e91e63;"><h4>üè∑Ô∏è Shop Label</h4><p>Print & post on job</p></div>
                <div id="form-a3schedule" class="form-card" onclick="openA3ScheduleModal()" style="background:#e8f5e9; border-color:#4caf50;"><h4>üìÖ A3 Schedule</h4><p>Work schedule view</p></div>
            </div>
        </div>
    </div>

    <div id="history" class="view-section">
        <div class="card">
            <h3>Job History</h3>
            <p style="color:#666; font-size:12px; margin-bottom:15px;">Save your current job using the üíæ button above to add it to history</p>
            
            <!-- Filter Buttons -->
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:15px;">
                <button onclick="filterHistory('all')" id="filter-all" style="background:#d4af37; color:#000; border:none; padding:8px 14px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">ALL</button>
                <button onclick="filterHistory('active')" id="filter-active" style="background:#f0f0f0; color:#666; border:none; padding:8px 14px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">ACTIVE</button>
                <button onclick="filterHistory('completed')" id="filter-completed" style="background:#f0f0f0; color:#666; border:none; padding:8px 14px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">COMPLETED</button>
            </div>
        </div>
        <div id="history-list"></div>
    </div>
    
    <div id="schedule" class="view-section" style="width:100vw; margin-left:calc(-50vw + 50%); position:relative;">
    

        <!-- Global Notifications -->
        <div class="card" style="background:#f0fdf4; border-left:5px solid #34c759; margin-left:0; margin-right:0;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; color:#34c759;">üîî Global Notifications</h3>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span id="notificationBadge" style="background:#ff3b30; color:#fff; border-radius:50%; width:24px; height:24px; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:12px;">0</span>
                    <button onclick="toggleNotifications()" style="border:none; background:#34c759; color:#fff; padding:6px 12px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">‚àí</button>
                </div>
            </div>
            <div id="globalNotifications" style="max-height:200px; overflow-y:auto; display:block;">
                <p style="color:#999; text-align:center; font-size:12px;">No notifications yet</p>
            </div>
        </div>

        <div class="card" style="margin-left:0; margin-right:0;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">Jobs Chart</h3>
                <div style="display:flex; gap:8px;">
                    <button onclick="prevScheduleMonth()" style="border:none; background:#f0f0f0; width:35px; height:35px; border-radius:6px; font-weight:900; cursor:pointer;">‚Üê</button>
                    <button onclick="nextScheduleMonth()" style="border:none; background:#f0f0f0; width:35px; height:35px; border-radius:6px; font-weight:900; cursor:pointer;">‚Üí</button>
                    <button id="jobsChartToggleBtn" onclick="toggleJobsChart()" title="Minimize/Maximize" style="border:none; background:#2196f3; color:#fff; width:35px; height:35px; border-radius:6px; font-weight:900; cursor:pointer; font-size:18px;">‚àí</button>
                </div>
            </div>
            <div id="scheduleMonthYear" style="text-align:center; font-weight:900; font-size:16px; margin-bottom:15px; color:#000;"></div>
        </div>

        <!-- Jobs Chart Timeline - Full Width -->
        <div id="ganttWrapper" style="width:100vw; margin-left:calc(-50vw + 50%); background:#fff; padding:15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow-x:auto; overflow-y:hidden; min-height:600px; display:block; visibility:visible; scroll-behavior:smooth; cursor:grab;">
            <!-- Jobs Chart Container -->
            <div id="ganttChart" style="min-width:1200px; padding:0; display:flex; flex-direction:column; user-select:none;">
                <!-- Jobs chart will render here -->
            </div>
        </div>
        <div style="text-align:center; font-size:11px; color:#999; margin-top:8px;">‚Üê Scroll horizontally to view different months ‚Üí</div>

    </div>
    
    <div id="admin" class="view-section">
        <h3 style="margin-bottom:10px;">Admin Settings</h3>
        
        <!-- Admin Sub-Tabs - Under Header -->
        <div class="sub-nav" style="margin-bottom:15px;">
            <button class="sub-btn active" onclick="switchAdminTab('general')" id="admin-tab-general">General Settings</button>
            <button class="sub-btn" onclick="switchAdminTab('colours')" id="admin-tab-colours">Colours</button>
            <button class="sub-btn" onclick="switchAdminTab('clients')" id="admin-tab-clients">Clients</button>
            <button class="sub-btn" onclick="switchAdminTab('pricing')" id="admin-tab-pricing">Price Matrix</button>
        </div>
        
        <div class="card">
            <!-- General Settings Tab -->
            <div id="admin-tab-general-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; margin-top:20px; font-weight:900;">Measure Tab Defaults</h4>
                    <button onclick="let container = document.getElementById('measure-defaults-container'); container.style.display = container.style.display === 'none' ? 'block' : 'none';" style="background:none; border:none; cursor:pointer; font-weight:900; font-size:18px; color:#999;">‚àí</button>
                </div>
                <div id="measure-defaults-container" style="display:block;">
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Set default values for new parts in the Measure tab</p>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Default Material Thickness (mm)</label>
                        <input type="number" id="defaultThickness" value="18" min="1" max="50" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                    <div>
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Default SE Return Value (mm)</label>
                        <input type="number" id="defaultSEReturn" value="100" min="10" max="500" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                </div>
                <button onclick="saveDefaultSettings()" style="border:none; background:#34c759; color:#fff; padding:10px 15px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">‚úì SAVE DEFAULTS</button>
                </div>
                
                <hr style="margin:30px 0; border:none; border-top:1px solid #ddd;">
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; margin-top:20px; font-weight:900;">Default Job Timeline</h4>
                    <button onclick="let container = document.getElementById('timeline-defaults-container'); container.style.display = container.style.display === 'none' ? 'block' : 'none';" style="background:none; border:none; cursor:pointer; font-weight:900; font-size:18px; color:#999;">‚àí</button>
                </div>
                <div id="timeline-defaults-container" style="display:block;">
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Set default duration for each job phase - used to generate timeline in jobs chart</p>
                
                <!-- Individual Task Duration Settings -->
                <div style="background:#f5f5f5; padding:15px; border-radius:6px; margin-bottom:15px;">
                    <h5 style="margin:0 0 12px 0; font-weight:bold; font-size:12px;">Task Phase Durations (Days)</h5>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:12px;">
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">M (Measure)</label>
                            <input type="number" id="taskDuration_m" value="2" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">S1 (Sand 1)</label>
                            <input type="number" id="taskDuration_s1" value="3" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">U (Undercoat)</label>
                            <input type="number" id="taskDuration_u" value="2" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">S2 (Sand 2)</label>
                            <input type="number" id="taskDuration_s2" value="2" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">I (Install)</label>
                            <input type="number" id="taskDuration_i" value="1" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">T (Touch-up)</label>
                            <input type="number" id="taskDuration_t" value="1" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">C (Complete)</label>
                            <input type="number" id="taskDuration_c" value="1" min="0" max="10" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box; text-align:center;" oninput="updateTotalTimelineDays()">
                        </div>
                    </div>
                    <div style="text-align:center; padding:8px; background:#fff; border-radius:4px; border:1px solid #ddd;">
                        <span style="font-size:10px; color:#666; font-weight:900;">Total Duration: </span>
                        <span id="totalTimelineDays" style="font-size:12px; font-weight:900; color:#d4af37;">12 days</span>
                    </div>
                </div>
                
                <!-- Overall Settings -->
                <div style="display:grid; grid-template-columns:1fr; gap:15px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Default Status for New Jobs</label>
                        <select id="defaultTimelineStatus" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                            <option value="Pending">Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="On Hold">On Hold</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveTimelineDefaults()" style="border:none; background:#34c759; color:#fff; padding:10px 15px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">‚úì SAVE TIMELINE DEFAULTS</button>
                </div>
                
                <hr style="margin:30px 0; border:none; border-top:1px solid #ddd;">
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; margin-top:20px; font-weight:900;">Company Details (PDF Header)</h4>
                    <button onclick="let container = document.getElementById('company-details-container'); container.style.display = container.style.display === 'none' ? 'block' : 'none';" style="background:none; border:none; cursor:pointer; font-weight:900; font-size:18px; color:#999;">‚àí</button>
                </div>
                <div id="company-details-container" style="display:block;">
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Update your company information displayed on all PDF forms (Estimates, Quotes, Invoices, Supply Dockets)</p>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Company Name</label>
                        <input type="text" id="companyName" placeholder="Paintworkz" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                    <div>
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Phone Number</label>
                        <input type="text" id="companyPhone" placeholder="0438 803 032" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                    <div style="grid-column:1 / -1;">
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Email Address</label>
                        <input type="email" id="companyEmail" placeholder="paint_workz@outlook.com" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                    <div style="grid-column:1 / -1;">
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Address</label>
                        <input type="text" id="companyAddress" placeholder="17 West Boundary Road, Hamilton 3300 VIC" style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:12px; box-sizing:border-box;">
                    </div>
                    <div style="grid-column:1 / -1;">
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Company Logo (PNG - Circle Logo)</label>
                        <input type="file" id="companyLogo" accept="image/png" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:11px; box-sizing:border-box;">
                        <p style="font-size:10px; color:#999; margin-top:5px; margin-bottom:0;">Upload a PNG file for your circle logo (recommended size: 150x150px)</p>
                    </div>
                    <div style="grid-column:1 / -1;">
                        <label style="display:block; font-weight:900; font-size:11px; color:#666; margin-bottom:5px;">Header Logo (PNG - Full Brand Header)</label>
                        <input type="file" id="headerLogo" accept="image/png" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:11px; box-sizing:border-box;">
                        <p style="font-size:10px; color:#999; margin-top:5px; margin-bottom:0;">Upload a PNG file for your header/branding logo (recommended size: 1024x300px or similar aspect ratio)</p>
                    </div>
                </div>
                <button onclick="saveCompanyDetails()" style="border:none; background:#d4af37; color:#000; padding:10px 15px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer; margin-right:10px;">üíæ SAVE COMPANY DETAILS</button>
                <button onclick="resetCompanyDetails()" style="border:none; background:#ff9500; color:#fff; padding:10px 15px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">‚Üª RESET TO DEFAULTS</button>
                </div>
                
                <hr style="margin:30px 0; border:none; border-top:1px solid #ddd;">
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; margin-top:20px; font-weight:900;">Additional Charges Configuration</h4>
                    <button onclick="let container = document.getElementById('additional-charges-container'); container.style.display = container.style.display === 'none' ? 'block' : 'none';" style="background:none; border:none; cursor:pointer; font-weight:900; font-size:18px; color:#999;">‚àí</button>
                </div>
                <div id="additional-charges-container" style="display:block;">
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Configure door colour multipliers and delivery region charges</p>
                
                <!-- Door Colour Multipliers -->
                <div style="margin-bottom:20px; padding:15px; background:#f5f5f5; border-radius:6px;">
                    <h5 style="margin:0 0 15px 0; font-weight:bold; font-size:12px;">Door Colour Multipliers (% of paint price)</h5>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Clear</label>
                            <input type="number" id="chargeClear" value="0" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Standard</label>
                            <input type="number" id="chargeStandard" value="5" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Light</label>
                            <input type="number" id="chargeLight" value="5" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Dark</label>
                            <input type="number" id="chargeDark" value="15" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Extra Tint</label>
                            <input type="number" id="chargeExtraTint" value="30" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Undercoat (% of paint only)</label>
                            <input type="number" id="chargeUndercoat" value="80" min="0" max="100" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Colour Match</label>
                            <input type="number" id="chargeColourMatch" value="130" min="0" max="300" step="0.5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Regions -->
                <div style="margin-bottom:20px; padding:15px; background:#f5f5f5; border-radius:6px;">
                    <h5 style="margin:0 0 15px 0; font-weight:bold; font-size:12px;">Delivery/Pickup Regions ($)</h5>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Warrnambool</label>
                            <input type="number" id="regionWarrnambool" value="90" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Geelong</label>
                            <input type="number" id="regionGeelong" value="110" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Mt Gambier</label>
                            <input type="number" id="regionMtGambier" value="110" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Adelaide</label>
                            <input type="number" id="regionAdelaide" value="250" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Horsham</label>
                            <input type="number" id="regionHorsham" value="110" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">Ballarat</label>
                            <input type="number" id="regionBallarat" value="160" min="0" step="5" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                    </div>
                </div>
                
                <!-- Other Settings -->
                <div style="margin-bottom:20px; padding:15px; background:#f5f5f5; border-radius:6px;">
                    <h5 style="margin:0 0 15px 0; font-weight:bold; font-size:12px;">Other Settings</h5>
                    <div style="display:grid; grid-template-columns:1fr; gap:12px;">
                        <div>
                            <label style="display:block; font-weight:900; font-size:10px; color:#666; margin-bottom:4px;">GST Rate (%) - Applied to subtotal + charges</label>
                            <input type="number" id="gstRate" value="10" min="0" max="25" step="0.1" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:11px; box-sizing:border-box;">
                        </div>
                    </div>
                </div>
                
                <button onclick="saveAdditionalCharges()" style="border:none; background:#34c759; color:#fff; padding:10px 15px; border-radius:6px; font-weight:900; font-size:11px; cursor:pointer;">‚úì SAVE CHARGES</button>
                </div>
                
                <hr style="margin:30px 0; border:none; border-top:1px solid #ddd;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h4 style="margin:0; margin-top:20px; font-weight:900;">Notification Archive</h4>
                    <button onclick="toggleAdminAlerts()" style="background:none; border:none; cursor:pointer; font-weight:900; font-size:18px; color:#999;">‚àí</button>
                </div>
                <div id="admin-alerts-container" style="display:block;">
                    <div id="admin-alerts"></div>
                </div>
                
                <h4 style="margin-top:20px; margin-bottom:10px; font-weight:900;">Database Status</h4>
                <p style="font-size:11px; color:#666; margin-bottom:10px; background:#f0f0f0; padding:10px; border-radius:6px;">All systems operational. Job history is clean and synced.</p>
                
                <hr style="margin:30px 0; border:none; border-top:1px solid #ddd;">
                
                <div style="background:#f5f5f5; border-left:4px solid #d4af37; padding:15px; border-radius:6px; margin-top:20px;">
                    <p style="font-size:10px; color:#666; margin:0; line-height:1.6;">
                        <strong style="color:#333; font-weight:900;">PaintWorkz Pro</strong><br>
                        <span style="color:#999;">Created by Colin Bedford</span><br>
                        <span style="color:#999;">Paintworkz PTY LTD</span><br>
                        <span id="currentDate" style="color:#999;">14 February 2026</span><br><br>
                        <span id="versionDisplay" style="color:#d4af37; font-weight:900;">v1.4.1 | </span><span id="versionDate" style="color:#d4af37; font-weight:900;"></span>
                    </p>
                </div>
            </div>
            
            <!-- Colours Tab -->
            <div id="admin-tab-colours-content" style="display:none;">
                <h4 style="margin-top:20px; margin-bottom:10px; font-weight:900;">Theme Colours</h4>
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Customize all colours throughout the app - changes apply instantly</p>
                <div id="colorCustomizerContent" style="display:grid; grid-template-columns:1fr 1fr; gap:15px;"></div>
            </div>
            
            <!-- Clients Database Tab -->
            <div id="admin-tab-clients-content" style="display:none;">
                <h4 style="margin-top:20px; margin-bottom:10px; font-weight:900;">Client Database</h4>
                <p style="font-size:11px; color:#666; margin-bottom:15px;">Scroll to see all clients or search by name</p>
                <button onclick="showAddClientForm()" style="border:none; background:#34c759; color:#fff; padding:12px 20px; border-radius:6px; font-weight:900; font-size:12px; cursor:pointer; width:100%; margin-bottom:15px;">‚ûï ADD NEW CLIENT</button>
                
                <!-- Search box -->
                <input type="text" id="clientSearchBox" placeholder="üîç Search clients..." style="width:100%; padding:12px; border:1px solid #ddd; border-radius:6px; font-size:13px; box-sizing:border-box; margin-bottom:15px;" onkeyup="filterClientList()">
                
                <!-- Scrollable client list container with visible scrollbar -->
                <div style="border:1px solid #ddd; border-radius:8px; background:#fff; padding:0;">
                    <div id="clientsList" style="height:500px; overflow-y:scroll; display:flex; flex-direction:column; gap:0; padding:10px; scrollbar-width:thin; scrollbar-color:#2196f3 #f0f0f0;"></div>
                </div>
            </div>
            
            <!-- Price Matrix Tab -->
            <div id="admin-tab-pricing-content" style="display:none;">
                <div id="admin-pricing-matrix" style="margin-top:15px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- WORKLOAD SUMMARY CONTAINER - Shows only in Schedule/Admin -->
<div id="workloadSummaryContainer" style="display:none; background:#f9f9f9; border-top:1px solid #ddd; padding:12px 15px; position:fixed; bottom:60px; left:0; right:0; z-index:100;">
    <div class="card" style="margin:0; background:transparent;">
        <h4 style="margin-top:0; margin-bottom:8px; font-size:12px;">Workload Summary</h4>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
            <div style="text-align:center; padding:8px;">
                <div id="totalActiveJobs" style="font-size:18px; font-weight:900; color:var(--gs);">0</div>
                <div style="font-size:9px; color:#666; font-weight:700;">Active Jobs</div>
            </div>
            <div style="text-align:center; padding:8px; border-left:1px solid #ddd; border-right:1px solid #ddd;">
                <div id="totalTasks" style="font-size:18px; font-weight:900; color:#ff9500;">0/0</div>
                <div style="font-size:9px; color:#666; font-weight:700;">Tasks Complete</div>
            </div>
            <div style="text-align:center; padding:8px;">
                <div id="totalWorkload" style="font-size:18px; font-weight:900; color:#2196f3;">0</div>
                <div style="font-size:9px; color:#666; font-weight:700;">SQM Workload</div>
            </div>
        </div>
    </div>
</div>

    <!-- Global Notifications Banner - Visible on all tabs -->
    <div id="globalNotificationsBanner" style="position:fixed; top:0; left:0; right:0; z-index:9999; background:linear-gradient(90deg, #fffef0 0%, #fffff8 100%); border-bottom:4px solid #ffc107; padding:16px; padding-top:20px; min-height:60px; max-height:250px; overflow-y:auto; display:none; box-shadow:0 4px 12px rgba(255, 193, 7, 0.3);">
        <div id="globalNotificationsList" style="margin:0;"></div>
    </div>
    
<div class="sticky-footer">
    <div class="footer-item" style="margin-left:15px;"><div class="footer-label">TOTAL SQM (m¬≤)</div><div class="footer-val" id="tA">0.000</div></div>
    <div style="flex:1; display:flex; justify-content:center; gap:20px; align-items:center;">
        <div class="icon-btn" onclick="genPDF()" style="color:#fff">üìÑ</div>
        <div id="footerVersionDisplay" style="display:none; font-size:10px; color:#d4af37; font-weight:900;">PaintWorkz Pro v1.4.1</div>
    </div>
    <div class="footer-item"><div class="footer-label">PARTS</div><div class="footer-val" id="tQ">0</div></div>
    <div class="icon-btn" onclick="handleLogout()" title="Logout" style="color:#ff3b30; font-size:24px; cursor:pointer; margin-right:15px;">üö™</div>
</div>

<script>
    // ===== PAINTWORKZ REVISION INFO =====
    console.log('%c üé® PaintWorkz Pro 4.8 1.1.6 (2026-02-12) ', 'background:#d4af37;color:#000;font-weight:900;padding:8px;border-radius:4px;');
    console.log('‚úÖ CRITICAL FIXES:');
    console.log('‚úì Disabled Firebase real-time sync (memory crashes fixed)');
    console.log('‚úì Improved error handling to prevent crashes');
    console.log('‚úì Door profile persistence fixed');
    console.log('‚úì Job completion toggle working');
    console.log('‚úì Measure sheet clears on save');
    console.log('‚úì Workload summary correctly excludes completed');
    console.log('‚úì RESTORED: Detailed timeline configuration with individual task phase durations (M/S1/U/S2/I/T/C)');
    
    // Update total timeline days calculation
    function updateTotalTimelineDays() {
        const m = parseInt(document.getElementById('taskDuration_m')?.value) || 0;
        const s1 = parseInt(document.getElementById('taskDuration_s1')?.value) || 0;
        const u = parseInt(document.getElementById('taskDuration_u')?.value) || 0;
        const s2 = parseInt(document.getElementById('taskDuration_s2')?.value) || 0;
        const i = parseInt(document.getElementById('taskDuration_i')?.value) || 0;
        const t = parseInt(document.getElementById('taskDuration_t')?.value) || 0;
        const c = parseInt(document.getElementById('taskDuration_c')?.value) || 0;
        
        const total = m + s1 + u + s2 + i + t + c;
        const totalElement = document.getElementById('totalTimelineDays');
        if (totalElement) {
            totalElement.textContent = total + ' days';
        }
        return total;
    }
    
    // ====================================
    
    // Firebase already initialized at top of page
    let isSignup = false;

    // Wait for Firebase to be initialized before using it
    function waitForFirebase() {
        if (typeof auth !== 'undefined' && auth !== null) {
            // Firebase is ready, set up auth listener
            window.onAuthStateChanged((user) => {
              if (user) {
                window.currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('userInfo').innerHTML = `
                  <span style="font-weight:900;">üë§ ${user.email.split('@')[0]}</span>
                  <button id="logoutBtn" onclick="logout()" style="background:#ff3b30; color:#fff; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; font-weight:900; margin-left:10px;">Logout</button>
                `;
                loadDataFromFirestore();
              } else {
                window.currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('userInfo').innerHTML = '';
              }
            });
        } else {
            // Firebase not ready yet, try again
            setTimeout(waitForFirebase, 100);
        }
    }
    
    // Start waiting for Firebase
    waitForFirebase();

    // Login/Signup Handler
    function handleAuth() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');
      
      if (!email || !password) {
        errorDiv.innerHTML = '‚ö†Ô∏è Please enter email and password';
        return;
      }
      
      if (isSignup) {
        window.createUserWithEmailAndPassword(email, password)
          .then(result => {
            errorDiv.innerHTML = '‚úÖ Account created! Logging in...';
            setTimeout(() => {
              document.getElementById('loginEmail').value = '';
              document.getElementById('loginPassword').value = '';
            }, 1000);
          })
          .catch(error => {
            errorDiv.innerHTML = '‚ùå ' + error.message;
          });
      } else {
        window.signInWithEmailAndPassword(email, password)
          .then(result => {
            errorDiv.innerHTML = '‚úÖ Logged in successfully!';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
          })
          .catch(error => {
            errorDiv.innerHTML = '‚ùå ' + error.message;
          });
      }
    }

    function toggleSignup() {
      isSignup = !isSignup;
      document.getElementById('loginTitle').innerHTML = isSignup ? 'Create Account' : 'PaintWorkz Login';
      document.getElementById('loginBtn').innerHTML = isSignup ? 'Sign Up' : 'Login';
      document.getElementById('toggleBtn').innerHTML = isSignup ? 'Have an account? Login' : "Don't have an account? Sign Up";
      document.getElementById('loginError').innerHTML = '';
    }

    function logout() {
      window.signOut().then(() => {
      });
    }

    // Save data to Firestore
    async function saveDataToFirestore() {
      if (!window.currentUser) {
        return;
      }
      
      try {
        const data = {
          items: items,
          client: document.getElementById('cli')?.value || '',
          dateReceived: document.getElementById('dRec')?.value || '',
          totalSqm: document.getElementById('sqm')?.value || '',
          doorProfiles: doorProfiles,
          paintData: paintData,
          lastSaved: new Date().toISOString()
        };
        
        const measureDocRef = window.doc(window.firebaseDb, 'users', window.currentUser.uid, 'data', 'measureData');
        await window.setDoc(measureDocRef, data);
        
        const historyDocRef = window.doc(window.firebaseDb, 'users', window.currentUser.uid, 'history', 'jobs');
        await window.setDoc(historyDocRef, {
          history: history,
          lastUpdated: new Date().toISOString()
        });
        
      } catch (error) {
      }
    }

    // Load data from Firestore
    async function loadDataFromFirestore() {
      if (!window.currentUser) return;
      
      try {
        // Load measure data
        const measureDocRef = window.doc(window.firebaseDb, 'users', window.currentUser.uid, 'data', 'measureData');
        const measureDoc = await window.getDoc(measureDocRef);
        if (measureDoc.exists()) {
          const data = measureDoc.data();
          items = data.items || [];
          doorProfiles = data.doorProfiles || [];
          paintData = data.paintData || [];
          if (document.getElementById('cli')) document.getElementById('cli').value = data.client || '';
          if (document.getElementById('dRec')) document.getElementById('dRec').value = data.dateReceived || '';
          if (document.getElementById('sqm')) document.getElementById('sqm').value = data.totalSqm || '';
        }
        
        // Load job history
        const historyDocRef = window.doc(window.firebaseDb, 'users', window.currentUser.uid, 'history', 'jobs');
        const historyDoc = await window.getDoc(historyDocRef);
        if (historyDoc.exists()) {
          history = historyDoc.data().history || [];
        }
        
        // NOTE: Door profiles are NOT loaded from Firebase
        // They are ONLY loaded from localStorage to prevent stale data
        // Firebase is used for backup/sync only, not for restoration
        
        refreshLists();
        renderHistory();
        renderScheduleCalendar();
        initializeDefaultSettings();  // Load default thickness and SE return values
        initializeTimelineDefaults();  // Load default timeline settings
        initializeCompanyDetailsForm();  // Load company details for PDF headers
      } catch (error) {
      }
    }

    // Timeline defaults management
    function saveTimelineDefaults() {
        const taskDurations = {
            m: parseInt(document.getElementById('taskDuration_m')?.value) || 2,
            s1: parseInt(document.getElementById('taskDuration_s1')?.value) || 3,
            u: parseInt(document.getElementById('taskDuration_u')?.value) || 2,
            s2: parseInt(document.getElementById('taskDuration_s2')?.value) || 2,
            i: parseInt(document.getElementById('taskDuration_i')?.value) || 1,
            t: parseInt(document.getElementById('taskDuration_t')?.value) || 1,
            c: parseInt(document.getElementById('taskDuration_c')?.value) || 1
        };
        
        const defaultStatus = document.getElementById('defaultTimelineStatus')?.value || 'Pending';
        
        const timelineDefaults = {
            taskDurations: taskDurations,
            defaultStatus: defaultStatus,
            totalDays: updateTotalTimelineDays()
        };
        
        localStorage.setItem('timelineDefaults', JSON.stringify(timelineDefaults));
        showToast('‚úì Timeline defaults saved');
        console.log('‚úì Timeline defaults saved:', timelineDefaults);
    }

    function initializeTimelineDefaults() {
        try {
            const saved = localStorage.getItem('timelineDefaults');
            if (saved) {
                const defaults = JSON.parse(saved);
                
                // Set task duration values
                if (defaults.taskDurations) {
                    document.getElementById('taskDuration_m').value = defaults.taskDurations.m || 2;
                    document.getElementById('taskDuration_s1').value = defaults.taskDurations.s1 || 3;
                    document.getElementById('taskDuration_u').value = defaults.taskDurations.u || 2;
                    document.getElementById('taskDuration_s2').value = defaults.taskDurations.s2 || 2;
                    document.getElementById('taskDuration_i').value = defaults.taskDurations.i || 1;
                    document.getElementById('taskDuration_t').value = defaults.taskDurations.t || 1;
                    document.getElementById('taskDuration_c').value = defaults.taskDurations.c || 1;
                }
                
                // Set default status
                if (defaults.defaultStatus) {
                    document.getElementById('defaultTimelineStatus').value = defaults.defaultStatus;
                }
                
                // Update total display
                updateTotalTimelineDays();
                
                console.log('‚úì Timeline defaults loaded:', defaults);
            } else {
                // Set default values if none saved
                updateTotalTimelineDays();
                console.log('‚ÑπÔ∏è Using default timeline values');
            }
        } catch (error) {
            console.error('Error loading timeline defaults:', error);
            updateTotalTimelineDays();
        }
    }

    // Rest of your JavaScript code would continue here...
    // The original file has thousands more lines - this is just the key updated section
    
</script>

</div>
</body>
</html>
