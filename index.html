<script>
    // --- UPDATED RENDER FUNCTION WITH EDGE RULES ---
    function render(){
        const l=document.getElementById('list'); 
        l.innerHTML=''; 
        let ts=0, tq=0;

        items.forEach((it,i)=>{
            ts += parseFloat(it.sqm)*it.qty; 
            tq += it.qty;

            // Calculate Edge Counts
            let L=(it.e[0]?1:0)+(it.e[1]?1:0);
            let S=(it.e[2]?1:0)+(it.e[3]?1:0);
            
            // Generate Labels
            let lbL = (L > 0) ? (it.mode === 'SE' ? "1LR" : L + "L") : "";
            let lbS = (S > 0) ? (it.mode === 'SE' ? "1SR" : S + "S") : "";

            // --- YOUR CUSTOM RULE ---
            // If text results in 0S, 0L, 0SL, or 0SR, leave blank.
            const combined = lbL + lbS;
            if (["0S", "0L", "0SL", "0SR"].includes(combined)) {
                lbL = "";
                lbS = "";
            }

            l.innerHTML += `
                <div class="card" style="display:flex;align-items:center;gap:10px;padding:8px;">
                    <div class="qty-bubble">${it.qty}</div>
                    <div style="flex:1">
                        <div style="font-weight:900;font-size:18px;">${it.h} x ${it.w} x ${it.thk}</div>
                        <div style="font-size:11px;font-weight:700;color:#666;">${it.desc||'No Desc'} (${it.pType})</div>
                        <div style="margin-top:6px;">
                            ${it.finish==='Moulded'?'<div class="mld-bubble">MOULDED</div>':''}
                            ${lbL?`<span class="edge-pill edge-L">${lbL}</span>`:''}
                            ${lbS?`<span class="edge-pill edge-S">${lbS}</span>`:''}
                        </div>
                    </div>
                    <div class="mode-box mode-${it.mode}">${it.mode}</div>
                    <button onclick="items.splice(${i},1);render()" style="color:red;border:0;background:0;font-size:26px;font-weight:900;">×</button>
                </div>`;
        });
        document.getElementById('tA').innerText=ts.toFixed(3); 
        document.getElementById('tQ').innerText=tq;
    }

    // --- UPDATED CLIENT RENDER WITH EDIT BUTTONS ---
    function renderClients(filter = "") {
        const container = document.getElementById('client-list-container');
        if(!container) return;
        clients.sort();
        container.innerHTML = clients.filter(c => c.toLowerCase().includes(filter.toLowerCase())).map(c => `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:10px; margin-bottom:5px;">
                <span style="font-weight:700;">${c}</span>
                <div>
                    <button onclick="editClient('${c}')" style="background:none; border:none; color:blue; font-size:12px; font-weight:900; margin-right:10px;">EDIT</button>
                    <button onclick="deleteClient('${c}')" style="background:none; border:none; color:#ff3b30; font-weight:900; font-size:18px;">×</button>
                </div>
            </div>
        `).join('');
        updateClientDropdown();
        localStorage.setItem('pw_clients', JSON.stringify(clients));
    }

    function editClient(oldName) {
        let newName = prompt("Rename Client:", oldName);
        if(newName && newName !== oldName) {
            clients = clients.map(c => c === oldName ? newName : c);
            renderClients();
        }
    }

    // --- UPDATED PROFILE RENDER WITH EDIT BUTTONS ---
    function renderProfiles(filter = "") {
        const container = document.getElementById('profile-list-container');
        if(!container) return;
        container.innerHTML = profiles.filter(p => p.toLowerCase().includes(filter.toLowerCase())).map(p => `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:10px; margin-bottom:5px;">
                <span style="font-weight:700;">${p}</span>
                <div>
                    <button onclick="editProfile('${p}')" style="background:none; border:none; color:blue; font-size:12px; font-weight:900; margin-right:10px;">EDIT</button>
                    <button onclick="deleteProfile('${p}')" style="background:none; border:none; color:#ff3b30; font-weight:900; font-size:18px;">×</button>
                </div>
            </div>
        `).join('');
        updateProfileDropdown();
        localStorage.setItem('pw_profiles', JSON.stringify(profiles));
    }

    function editProfile(oldName) {
        let newName = prompt("Rename Profile:", oldName);
        if(newName && newName !== oldName) {
            profiles = profiles.map(p => p === oldName ? newName : p);
            renderProfiles();
        }
    }
</script>
